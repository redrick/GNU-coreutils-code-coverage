<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>LCOV - coreutils - lib/parse-datetime.y</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">lib</a> - parse-datetime.y<span style="font-size: 80%;"> (source / <a href="parse-datetime.y.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coreutils</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">404</td>
            <td class="headerCovTableEntry">583</td>
            <td class="headerCovTableEntryLo">69.3 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2012-02-28</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">12</td>
            <td class="headerCovTableEntry">13</td>
            <td class="headerCovTableEntryHi">92.3 %</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">178</td>
            <td class="headerCovTableEntry">311</td>
            <td class="headerCovTableEntryLo">57.2 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data     Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :            : %{</a>
<span class="lineNum">       2 </span>                :            : /* Parse a string into an internal time stamp.
<span class="lineNum">       3 </span>                :            : 
<span class="lineNum">       4 </span>                :            :    Copyright (C) 1999-2000, 2002-2012 Free Software Foundation, Inc.
<span class="lineNum">       5 </span>                :            : 
<span class="lineNum">       6 </span>                :            :    This program is free software: you can redistribute it and/or modify
<span class="lineNum">       7 </span>                :            :    it under the terms of the GNU General Public License as published by
<span class="lineNum">       8 </span>                :            :    the Free Software Foundation; either version 3 of the License, or
<span class="lineNum">       9 </span>                :            :    (at your option) any later version.
<span class="lineNum">      10 </span>                :            : 
<span class="lineNum">      11 </span>                :            :    This program is distributed in the hope that it will be useful,
<span class="lineNum">      12 </span>                :            :    but WITHOUT ANY WARRANTY; without even the implied warranty of
<span class="lineNum">      13 </span>                :            :    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<span class="lineNum">      14 </span>                :            :    GNU General Public License for more details.
<span class="lineNum">      15 </span>                :            : 
<span class="lineNum">      16 </span>                :            :    You should have received a copy of the GNU General Public License
<span class="lineNum">      17 </span>                :            :    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.  */
<span class="lineNum">      18 </span>                :            : 
<span class="lineNum">      19 </span>                :            : /* Originally written by Steven M. Bellovin &lt;smb@research.att.com&gt; while
<span class="lineNum">      20 </span>                :            :    at the University of North Carolina at Chapel Hill.  Later tweaked by
<span class="lineNum">      21 </span>                :            :    a couple of people on Usenet.  Completely overhauled by Rich $alz
<span class="lineNum">      22 </span>                :            :    &lt;rsalz@bbn.com&gt; and Jim Berets &lt;jberets@bbn.com&gt; in August, 1990.
<span class="lineNum">      23 </span>                :            : 
<span class="lineNum">      24 </span>                :            :    Modified by Paul Eggert &lt;eggert@twinsun.com&gt; in August 1999 to do
<span class="lineNum">      25 </span>                :            :    the right thing about local DST.  Also modified by Paul Eggert
<span class="lineNum">      26 </span>                :            :    &lt;eggert@cs.ucla.edu&gt; in February 2004 to support
<span class="lineNum">      27 </span>                :            :    nanosecond-resolution time stamps, and in October 2004 to support
<span class="lineNum">      28 </span>                :            :    TZ strings in dates.  */
<span class="lineNum">      29 </span>                :            : 
<span class="lineNum">      30 </span>                :            : /* FIXME: Check for arithmetic overflow in all cases, not just
<span class="lineNum">      31 </span>                :            :    some of them.  */
<span class="lineNum">      32 </span>                :            : 
<span class="lineNum">      33 </span>                :            : #include &lt;config.h&gt;
<span class="lineNum">      34 </span>                :            : 
<span class="lineNum">      35 </span>                :            : #include &quot;parse-datetime.h&quot;
<span class="lineNum">      36 </span>                :            : 
<span class="lineNum">      37 </span>                :            : #include &quot;intprops.h&quot;
<span class="lineNum">      38 </span>                :            : #include &quot;timespec.h&quot;
<span class="lineNum">      39 </span>                :            : #include &quot;verify.h&quot;
<span class="lineNum">      40 </span>                :            : 
<span class="lineNum">      41 </span>                :            : /* There's no need to extend the stack, so there's no need to involve
<span class="lineNum">      42 </span>                :            :    alloca.  */
<span class="lineNum">      43 </span>                :            : #define YYSTACK_USE_ALLOCA 0
<span class="lineNum">      44 </span>                :            : 
<span class="lineNum">      45 </span>                :            : /* Tell Bison how much stack space is needed.  20 should be plenty for
<span class="lineNum">      46 </span>                :            :    this grammar, which is not right recursive.  Beware setting it too
<span class="lineNum">      47 </span>                :            :    high, since that might cause problems on machines whose
<span class="lineNum">      48 </span>                :            :    implementations have lame stack-overflow checking.  */
<span class="lineNum">      49 </span>                :            : #define YYMAXDEPTH 20
<span class="lineNum">      50 </span>                :            : #define YYINITDEPTH YYMAXDEPTH
<span class="lineNum">      51 </span>                :            : 
<span class="lineNum">      52 </span>                :            : /* Since the code of parse-datetime.y is not included in the Emacs executable
<span class="lineNum">      53 </span>                :            :    itself, there is no need to #define static in this file.  Even if
<span class="lineNum">      54 </span>                :            :    the code were included in the Emacs executable, it probably
<span class="lineNum">      55 </span>                :            :    wouldn't do any harm to #undef it here; this will only cause
<span class="lineNum">      56 </span>                :            :    problems if we try to write to a static variable, which I don't
<span class="lineNum">      57 </span>                :            :    think this code needs to do.  */
<span class="lineNum">      58 </span>                :            : #ifdef emacs
<span class="lineNum">      59 </span>                :            : # undef static
<span class="lineNum">      60 </span>                :            : #endif
<span class="lineNum">      61 </span>                :            : 
<span class="lineNum">      62 </span>                :            : #include &lt;c-ctype.h&gt;
<span class="lineNum">      63 </span>                :            : #include &lt;limits.h&gt;
<span class="lineNum">      64 </span>                :            : #include &lt;stdio.h&gt;
<span class="lineNum">      65 </span>                :            : #include &lt;stdlib.h&gt;
<span class="lineNum">      66 </span>                :            : #include &lt;string.h&gt;
<span class="lineNum">      67 </span>                :            : 
<span class="lineNum">      68 </span>                :            : #include &quot;xalloc.h&quot;
<span class="lineNum">      69 </span>                :            : 
<span class="lineNum">      70 </span>                :            : /* Bison's skeleton tests _STDLIB_H, while some stdlib.h headers
<span class="lineNum">      71 </span>                :            :    use _STDLIB_H_ as witness.  Map the latter to the one bison uses.  */
<span class="lineNum">      72 </span>                :            : /* FIXME: this is temporary.  Remove when we have a mechanism to ensure
<span class="lineNum">      73 </span>                :            :    that the version we're using is fixed, too.  */
<span class="lineNum">      74 </span>                :            : #ifdef _STDLIB_H_
<span class="lineNum">      75 </span>                :            : # undef _STDLIB_H
<span class="lineNum">      76 </span>                :            : # define _STDLIB_H 1
<span class="lineNum">      77 </span>                :            : #endif
<span class="lineNum">      78 </span>                :            : 
<span class="lineNum">      79 </span>                :            : /* ISDIGIT differs from isdigit, as follows:
<span class="lineNum">      80 </span>                :            :    - Its arg may be any int or unsigned int; it need not be an unsigned char
<span class="lineNum">      81 </span>                :            :      or EOF.
<span class="lineNum">      82 </span>                :            :    - It's typically faster.
<span class="lineNum">      83 </span>                :            :    POSIX says that only '0' through '9' are digits.  Prefer ISDIGIT to
<span class="lineNum">      84 </span>                :            :    isdigit unless it's important to use the locale's definition
<span class="lineNum">      85 </span>                :            :    of &quot;digit&quot; even when the host does not conform to POSIX.  */
<span class="lineNum">      86 </span>                :            : #define ISDIGIT(c) ((unsigned int) (c) - '0' &lt;= 9)
<span class="lineNum">      87 </span>                :            : 
<span class="lineNum">      88 </span>                :            : /* Shift A right by B bits portably, by dividing A by 2**B and
<span class="lineNum">      89 </span>                :            :    truncating towards minus infinity.  A and B should be free of side
<span class="lineNum">      90 </span>                :            :    effects, and B should be in the range 0 &lt;= B &lt;= INT_BITS - 2, where
<span class="lineNum">      91 </span>                :            :    INT_BITS is the number of useful bits in an int.  GNU code can
<span class="lineNum">      92 </span>                :            :    assume that INT_BITS is at least 32.
<span class="lineNum">      93 </span>                :            : 
<span class="lineNum">      94 </span>                :            :    ISO C99 says that A &gt;&gt; B is implementation-defined if A &lt; 0.  Some
<span class="lineNum">      95 </span>                :            :    implementations (e.g., UNICOS 9.0 on a Cray Y-MP EL) don't shift
<span class="lineNum">      96 </span>                :            :    right in the usual way when A &lt; 0, so SHR falls back on division if
<span class="lineNum">      97 </span>                :            :    ordinary A &gt;&gt; B doesn't seem to be the usual signed shift.  */
<span class="lineNum">      98 </span>                :            : #define SHR(a, b)       \
<span class="lineNum">      99 </span>                :            :   (-1 &gt;&gt; 1 == -1        \
<span class="lineNum">     100 </span>                :            :    ? (a) &gt;&gt; (b)         \
<span class="lineNum">     101 </span>                :            :    : (a) / (1 &lt;&lt; (b)) - ((a) % (1 &lt;&lt; (b)) &lt; 0))
<span class="lineNum">     102 </span>                :            : 
<span class="lineNum">     103 </span>                :            : #define EPOCH_YEAR 1970
<span class="lineNum">     104 </span>                :            : #define TM_YEAR_BASE 1900
<span class="lineNum">     105 </span>                :            : 
<span class="lineNum">     106 </span>                :            : #define HOUR(x) ((x) * 60)
<span class="lineNum">     107 </span>                :            : 
<span class="lineNum">     108 </span>                :            : /* long_time_t is a signed integer type that contains all time_t values.  */
<span class="lineNum">     109 </span>                :            : verify (TYPE_IS_INTEGER (time_t));
<span class="lineNum">     110 </span>                :            : #if TIME_T_FITS_IN_LONG_INT
<span class="lineNum">     111 </span>                :            : typedef long int long_time_t;
<span class="lineNum">     112 </span>                :            : #else
<span class="lineNum">     113 </span>                :            : typedef time_t long_time_t;
<span class="lineNum">     114 </span>                :            : #endif
<span class="lineNum">     115 </span>                :            : 
<span class="lineNum">     116 </span>                :            : /* Lots of this code assumes time_t and time_t-like values fit into
<span class="lineNum">     117 </span>                :            :    long_time_t.  */
<span class="lineNum">     118 </span>                :            : verify (TYPE_MINIMUM (long_time_t) &lt;= TYPE_MINIMUM (time_t)
<span class="lineNum">     119 </span>                :            :         &amp;&amp; TYPE_MAXIMUM (time_t) &lt;= TYPE_MAXIMUM (long_time_t));
<span class="lineNum">     120 </span>                :            : 
<span class="lineNum">     121 </span>                :            : /* FIXME: It also assumes that signed integer overflow silently wraps around,
<span class="lineNum">     122 </span>                :            :    but this is not true any more with recent versions of GCC 4.  */
<span class="lineNum">     123 </span>                :            : 
<span class="lineNum">     124 </span>                :            : /* An integer value, and the number of digits in its textual
<span class="lineNum">     125 </span>                :            :    representation.  */
<span class="lineNum">     126 </span>                :            : typedef struct
<span class="lineNum">     127 </span>                :            : {
<span class="lineNum">     128 </span>                :            :   bool negative;
<span class="lineNum">     129 </span>                :            :   long int value;
<span class="lineNum">     130 </span>                :            :   size_t digits;
<span class="lineNum">     131 </span>                :            : } textint;
<span class="lineNum">     132 </span>                :            : 
<span class="lineNum">     133 </span>                :            : /* An entry in the lexical lookup table.  */
<span class="lineNum">     134 </span>                :            : typedef struct
<span class="lineNum">     135 </span>                :            : {
<span class="lineNum">     136 </span>                :            :   char const *name;
<span class="lineNum">     137 </span>                :            :   int type;
<span class="lineNum">     138 </span>                :            :   int value;
<span class="lineNum">     139 </span>                :            : } table;
<span class="lineNum">     140 </span>                :            : 
<span class="lineNum">     141 </span>                :            : /* Meridian: am, pm, or 24-hour style.  */
<span class="lineNum">     142 </span>                :            : enum { MERam, MERpm, MER24 };
<span class="lineNum">     143 </span>                :            : 
<span class="lineNum">     144 </span>                :            : enum { BILLION = 1000000000, LOG10_BILLION = 9 };
<span class="lineNum">     145 </span>                :            : 
<span class="lineNum">     146 </span>                :            : /* Relative times.  */
<span class="lineNum">     147 </span>                :            : typedef struct
<span class="lineNum">     148 </span>                :            : {
<span class="lineNum">     149 </span>                :            :   /* Relative year, month, day, hour, minutes, seconds, and nanoseconds.  */
<span class="lineNum">     150 </span>                :            :   long int year;
<span class="lineNum">     151 </span>                :            :   long int month;
<span class="lineNum">     152 </span>                :            :   long int day;
<span class="lineNum">     153 </span>                :            :   long int hour;
<span class="lineNum">     154 </span>                :            :   long int minutes;
<span class="lineNum">     155 </span>                :            :   long_time_t seconds;
<span class="lineNum">     156 </span>                :            :   long int ns;
<span class="lineNum">     157 </span>                :            : } relative_time;
<span class="lineNum">     158 </span>                :            : 
<span class="lineNum">     159 </span>                :            : #if HAVE_COMPOUND_LITERALS
<span class="lineNum">     160 </span>                :            : # define RELATIVE_TIME_0 ((relative_time) { 0, 0, 0, 0, 0, 0, 0 })
<span class="lineNum">     161 </span>                :            : #else
<span class="lineNum">     162 </span>                :            : static relative_time const RELATIVE_TIME_0;
<span class="lineNum">     163 </span>                :            : #endif
<span class="lineNum">     164 </span>                :            : 
<span class="lineNum">     165 </span>                :            : /* Information passed to and from the parser.  */
<span class="lineNum">     166 </span>                :            : typedef struct
<span class="lineNum">     167 </span>                :            : {
<span class="lineNum">     168 </span>                :            :   /* The input string remaining to be parsed. */
<span class="lineNum">     169 </span>                :            :   const char *input;
<span class="lineNum">     170 </span>                :            : 
<span class="lineNum">     171 </span>                :            :   /* N, if this is the Nth Tuesday.  */
<span class="lineNum">     172 </span>                :            :   long int day_ordinal;
<span class="lineNum">     173 </span>                :            : 
<span class="lineNum">     174 </span>                :            :   /* Day of week; Sunday is 0.  */
<span class="lineNum">     175 </span>                :            :   int day_number;
<span class="lineNum">     176 </span>                :            : 
<span class="lineNum">     177 </span>                :            :   /* tm_isdst flag for the local zone.  */
<span class="lineNum">     178 </span>                :            :   int local_isdst;
<span class="lineNum">     179 </span>                :            : 
<span class="lineNum">     180 </span>                :            :   /* Time zone, in minutes east of UTC.  */
<span class="lineNum">     181 </span>                :            :   long int time_zone;
<span class="lineNum">     182 </span>                :            : 
<span class="lineNum">     183 </span>                :            :   /* Style used for time.  */
<span class="lineNum">     184 </span>                :            :   int meridian;
<span class="lineNum">     185 </span>                :            : 
<span class="lineNum">     186 </span>                :            :   /* Gregorian year, month, day, hour, minutes, seconds, and nanoseconds.  */
<span class="lineNum">     187 </span>                :            :   textint year;
<span class="lineNum">     188 </span>                :            :   long int month;
<span class="lineNum">     189 </span>                :            :   long int day;
<span class="lineNum">     190 </span>                :            :   long int hour;
<span class="lineNum">     191 </span>                :            :   long int minutes;
<span class="lineNum">     192 </span>                :            :   struct timespec seconds; /* includes nanoseconds */
<span class="lineNum">     193 </span>                :            : 
<span class="lineNum">     194 </span>                :            :   /* Relative year, month, day, hour, minutes, seconds, and nanoseconds.  */
<span class="lineNum">     195 </span>                :            :   relative_time rel;
<span class="lineNum">     196 </span>                :            : 
<span class="lineNum">     197 </span>                :            :   /* Presence or counts of nonterminals of various flavors parsed so far.  */
<span class="lineNum">     198 </span>                :            :   bool timespec_seen;
<span class="lineNum">     199 </span>                :            :   bool rels_seen;
<span class="lineNum">     200 </span>                :            :   size_t dates_seen;
<span class="lineNum">     201 </span>                :            :   size_t days_seen;
<span class="lineNum">     202 </span>                :            :   size_t local_zones_seen;
<span class="lineNum">     203 </span>                :            :   size_t dsts_seen;
<span class="lineNum">     204 </span>                :            :   size_t times_seen;
<span class="lineNum">     205 </span>                :            :   size_t zones_seen;
<span class="lineNum">     206 </span>                :            : 
<span class="lineNum">     207 </span>                :            :   /* Table of local time zone abbreviations, terminated by a null entry.  */
<span class="lineNum">     208 </span>                :            :   table local_time_zone_table[3];
<span class="lineNum">     209 </span>                :            : } parser_control;
<span class="lineNum">     210 </span>                :            : 
<span class="lineNum">     211 </span>                :            : union YYSTYPE;
<span class="lineNum">     212 </span>                :            : static int yylex (union YYSTYPE *, parser_control *);
<span class="lineNum">     213 </span>                :            : static int yyerror (parser_control const *, char const *);
<span class="lineNum">     214 </span>                :            : static long int time_zone_hhmm (parser_control *, textint, long int);
<span class="lineNum">     215 </span>                :            : 
<span class="lineNum">     216 </span>                :            : /* Extract into *PC any date and time info from a string of digits
<span class="lineNum">     217 </span>                :            :    of the form e.g., YYYYMMDD, YYMMDD, HHMM, HH (and sometimes YYY,
<a name="218"><span class="lineNum">     218 </span>                :            :    YYYY, ...).  */</a>
<span class="lineNum">     219 </span>                :            : static void
<span class="lineNum">     220 </span>                :<span class="lineCov">         35 : digits_to_date_time (parser_control *pc, textint text_int)</span>
<span class="lineNum">     221 </span>                :            : {
<span class="lineNum">     222 </span>[<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchCov" title="Branch 1 was taken 28 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         35 :   if (pc-&gt;dates_seen &amp;&amp; ! pc-&gt;year.digits</span>
<span class="lineNum">     223 </span>[<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          7 :       &amp;&amp; ! pc-&gt;rels_seen &amp;&amp; (pc-&gt;times_seen || 2 &lt; text_int.digits))</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 4 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<span class="lineNum">     224 </span>                :<span class="lineCov">          7 :     pc-&gt;year = text_int;</span>
<span class="lineNum">     225 </span>                :            :   else
<span class="lineNum">     226 </span>                :            :     {
<span class="lineNum">     227 </span>        [<span class="branchCov" title="Branch 0 was taken 21 times"> + </span><span class="branchCov" title="Branch 1 was taken 7 times"> + </span>]:<span class="lineCov">         28 :       if (4 &lt; text_int.digits)</span>
<span class="lineNum">     228 </span>                :            :         {
<span class="lineNum">     229 </span>                :<span class="lineCov">         21 :           pc-&gt;dates_seen++;</span>
<span class="lineNum">     230 </span>                :<span class="lineCov">         21 :           pc-&gt;day = text_int.value % 100;</span>
<span class="lineNum">     231 </span>                :<span class="lineCov">         21 :           pc-&gt;month = (text_int.value / 100) % 100;</span>
<span class="lineNum">     232 </span>                :<span class="lineCov">         21 :           pc-&gt;year.value = text_int.value / 10000;</span>
<span class="lineNum">     233 </span>                :<span class="lineCov">         21 :           pc-&gt;year.digits = text_int.digits - 4;</span>
<span class="lineNum">     234 </span>                :            :         }
<span class="lineNum">     235 </span>                :            :       else
<span class="lineNum">     236 </span>                :            :         {
<span class="lineNum">     237 </span>                :<span class="lineCov">          7 :           pc-&gt;times_seen++;</span>
<span class="lineNum">     238 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          7 :           if (text_int.digits &lt;= 2)</span>
<span class="lineNum">     239 </span>                :            :             {
<span class="lineNum">     240 </span>                :<span class="lineCov">          7 :               pc-&gt;hour = text_int.value;</span>
<span class="lineNum">     241 </span>                :<span class="lineCov">          7 :               pc-&gt;minutes = 0;</span>
<span class="lineNum">     242 </span>                :            :             }
<span class="lineNum">     243 </span>                :            :           else
<span class="lineNum">     244 </span>                :            :             {
<span class="lineNum">     245 </span>                :<span class="lineNoCov">          0 :               pc-&gt;hour = text_int.value / 100;</span>
<span class="lineNum">     246 </span>                :<span class="lineNoCov">          0 :               pc-&gt;minutes = text_int.value % 100;</span>
<span class="lineNum">     247 </span>                :            :             }
<span class="lineNum">     248 </span>                :<span class="lineCov">          7 :           pc-&gt;seconds.tv_sec = 0;</span>
<span class="lineNum">     249 </span>                :<span class="lineCov">          7 :           pc-&gt;seconds.tv_nsec = 0;</span>
<span class="lineNum">     250 </span>                :<span class="lineCov">          7 :           pc-&gt;meridian = MER24;</span>
<span class="lineNum">     251 </span>                :            :         }
<span class="lineNum">     252 </span>                :            :     }
<span class="lineNum">     253 </span>                :<span class="lineCov">         35 : }</span>
<span class="lineNum">     254 </span>                :            : 
<a name="255"><span class="lineNum">     255 </span>                :            : /* Increment PC-&gt;rel by FACTOR * REL (FACTOR is 1 or -1).  */</a>
<span class="lineNum">     256 </span>                :            : static void
<span class="lineNum">     257 </span>                :<span class="lineCov">       3066 : apply_relative_time (parser_control *pc, relative_time rel, int factor)</span>
<span class="lineNum">     258 </span>                :            : {
<span class="lineNum">     259 </span>                :<span class="lineCov">       3066 :   pc-&gt;rel.ns += factor * rel.ns;</span>
<span class="lineNum">     260 </span>                :<span class="lineCov">       3066 :   pc-&gt;rel.seconds += factor * rel.seconds;</span>
<span class="lineNum">     261 </span>                :<span class="lineCov">       3066 :   pc-&gt;rel.minutes += factor * rel.minutes;</span>
<span class="lineNum">     262 </span>                :<span class="lineCov">       3066 :   pc-&gt;rel.hour += factor * rel.hour;</span>
<span class="lineNum">     263 </span>                :<span class="lineCov">       3066 :   pc-&gt;rel.day += factor * rel.day;</span>
<span class="lineNum">     264 </span>                :<span class="lineCov">       3066 :   pc-&gt;rel.month += factor * rel.month;</span>
<span class="lineNum">     265 </span>                :<span class="lineCov">       3066 :   pc-&gt;rel.year += factor * rel.year;</span>
<span class="lineNum">     266 </span>                :<span class="lineCov">       3066 :   pc-&gt;rels_seen = true;</span>
<span class="lineNum">     267 </span>                :<span class="lineCov">       3066 : }</span>
<span class="lineNum">     268 </span>                :            : 
<a name="269"><span class="lineNum">     269 </span>                :            : /* Set PC-&gt; hour, minutes, seconds and nanoseconds members from arguments.  */</a>
<span class="lineNum">     270 </span>                :            : static void
<span class="lineNum">     271 </span>                :<span class="lineCov">        504 : set_hhmmss (parser_control *pc, long int hour, long int minutes,</span>
<span class="lineNum">     272 </span>                :            :             time_t sec, long int nsec)
<span class="lineNum">     273 </span>                :            : {
<span class="lineNum">     274 </span>                :<span class="lineCov">        504 :   pc-&gt;hour = hour;</span>
<span class="lineNum">     275 </span>                :<span class="lineCov">        504 :   pc-&gt;minutes = minutes;</span>
<span class="lineNum">     276 </span>                :<span class="lineCov">        504 :   pc-&gt;seconds.tv_sec = sec;</span>
<span class="lineNum">     277 </span>                :<span class="lineCov">        504 :   pc-&gt;seconds.tv_nsec = nsec;</span>
<span class="lineNum">     278 </span>                :<span class="lineCov">        504 : }</span>
<span class="lineNum">     279 </span>                :            : 
<span class="lineNum">     280 </span>                :            : %}
<span class="lineNum">     281 </span>                :            : 
<span class="lineNum">     282 </span>                :            : /* We want a reentrant parser, even if the TZ manipulation and the calls to
<span class="lineNum">     283 </span>                :            :    localtime and gmtime are not reentrant.  */
<span class="lineNum">     284 </span>                :            : %pure-parser
<span class="lineNum">     285 </span>                :            : %parse-param { parser_control *pc }
<span class="lineNum">     286 </span>                :            : %lex-param { parser_control *pc }
<span class="lineNum">     287 </span>                :            : 
<span class="lineNum">     288 </span>                :            : /* This grammar has 31 shift/reduce conflicts. */
<span class="lineNum">     289 </span>                :            : %expect 31
<span class="lineNum">     290 </span>                :            : 
<span class="lineNum">     291 </span>                :            : %union
<span class="lineNum">     292 </span>                :            : {
<span class="lineNum">     293 </span>                :            :   long int intval;
<span class="lineNum">     294 </span>                :            :   textint textintval;
<span class="lineNum">     295 </span>                :            :   struct timespec timespec;
<span class="lineNum">     296 </span>                :            :   relative_time rel;
<span class="lineNum">     297 </span>                :            : }
<span class="lineNum">     298 </span>                :            : 
<span class="lineNum">     299 </span>                :            : %token &lt;intval&gt; tAGO
<span class="lineNum">     300 </span>                :            : %token tDST
<span class="lineNum">     301 </span>                :            : 
<span class="lineNum">     302 </span>                :            : %token tYEAR_UNIT tMONTH_UNIT tHOUR_UNIT tMINUTE_UNIT tSEC_UNIT
<span class="lineNum">     303 </span>                :            : %token &lt;intval&gt; tDAY_UNIT tDAY_SHIFT
<span class="lineNum">     304 </span>                :            : 
<span class="lineNum">     305 </span>                :            : %token &lt;intval&gt; tDAY tDAYZONE tLOCAL_ZONE tMERIDIAN
<span class="lineNum">     306 </span>                :            : %token &lt;intval&gt; tMONTH tORDINAL tZONE
<span class="lineNum">     307 </span>                :            : 
<span class="lineNum">     308 </span>                :            : %token &lt;textintval&gt; tSNUMBER tUNUMBER
<span class="lineNum">     309 </span>                :            : %token &lt;timespec&gt; tSDECIMAL_NUMBER tUDECIMAL_NUMBER
<span class="lineNum">     310 </span>                :            : 
<span class="lineNum">     311 </span>                :            : %type &lt;intval&gt; o_colon_minutes
<span class="lineNum">     312 </span>                :            : %type &lt;timespec&gt; seconds signed_seconds unsigned_seconds
<span class="lineNum">     313 </span>                :            : 
<span class="lineNum">     314 </span>                :            : %type &lt;rel&gt; relunit relunit_snumber dayshift
<span class="lineNum">     315 </span>                :            : 
<span class="lineNum">     316 </span>                :            : %%
<span class="lineNum">     317 </span>                :            : 
<span class="lineNum">     318 </span>                :            : spec:
<span class="lineNum">     319 </span>                :            :     timespec
<span class="lineNum">     320 </span>                :            :   | items
<span class="lineNum">     321 </span>                :            :   ;
<span class="lineNum">     322 </span>                :            : 
<span class="lineNum">     323 </span>                :            : timespec:
<span class="lineNum">     324 </span>                :            :     '@' seconds
<span class="lineNum">     325 </span>                :            :       {
<span class="lineNum">     326 </span>                :<span class="lineCov">         42 :         pc-&gt;seconds = $2;</span>
<span class="lineNum">     327 </span>                :<span class="lineCov">         42 :         pc-&gt;timespec_seen = true;</span>
<span class="lineNum">     328 </span>                :            :       }
<span class="lineNum">     329 </span>                :<span class="lineCov">         42 :   ;</span>
<span class="lineNum">     330 </span>                :            : 
<span class="lineNum">     331 </span>                :            : items:
<span class="lineNum">     332 </span>                :            :     /* empty */
<span class="lineNum">     333 </span>                :            :   | items item
<span class="lineNum">     334 </span>                :            :   ;
<span class="lineNum">     335 </span>                :            : 
<span class="lineNum">     336 </span>                :            : item:
<span class="lineNum">     337 </span>                :            :     datetime
<span class="lineNum">     338 </span>                :<span class="lineCov">         35 :       { pc-&gt;times_seen++; pc-&gt;dates_seen++; }</span>
<span class="lineNum">     339 </span>                :<span class="lineCov">         35 :   | time</span>
<span class="lineNum">     340 </span>                :<span class="lineCov">        469 :       { pc-&gt;times_seen++; }</span>
<span class="lineNum">     341 </span>                :<span class="lineCov">        469 :   | local_zone</span>
<span class="lineNum">     342 </span>                :<span class="lineNoCov">          0 :       { pc-&gt;local_zones_seen++; }</span>
<span class="lineNum">     343 </span>                :<span class="lineNoCov">          0 :   | zone</span>
<span class="lineNum">     344 </span>                :<span class="lineCov">        280 :       { pc-&gt;zones_seen++; }</span>
<span class="lineNum">     345 </span>                :<span class="lineCov">        280 :   | date</span>
<span class="lineNum">     346 </span>                :<span class="lineCov">       3227 :       { pc-&gt;dates_seen++; }</span>
<span class="lineNum">     347 </span>                :<span class="lineCov">       3227 :   | day</span>
<span class="lineNum">     348 </span>                :<span class="lineCov">        133 :       { pc-&gt;days_seen++; }</span>
<span class="lineNum">     349 </span>                :<span class="lineCov">        133 :   | rel</span>
<span class="lineNum">     350 </span>                :            :   | number
<span class="lineNum">     351 </span>                :            :   | hybrid
<span class="lineNum">     352 </span>                :            :   ;
<span class="lineNum">     353 </span>                :            : 
<span class="lineNum">     354 </span>                :            : datetime:
<span class="lineNum">     355 </span>                :            :     iso_8601_datetime
<span class="lineNum">     356 </span>                :            :   ;
<span class="lineNum">     357 </span>                :            : 
<span class="lineNum">     358 </span>                :            : iso_8601_datetime:
<span class="lineNum">     359 </span>                :            :     iso_8601_date 'T' iso_8601_time
<span class="lineNum">     360 </span>                :            :   ;
<span class="lineNum">     361 </span>                :            : 
<span class="lineNum">     362 </span>                :            : time:
<span class="lineNum">     363 </span>                :            :     tUNUMBER tMERIDIAN
<span class="lineNum">     364 </span>                :            :       {
<span class="lineNum">     365 </span>                :<span class="lineNoCov">          0 :         set_hhmmss (pc, $1.value, 0, 0, 0);</span>
<span class="lineNum">     366 </span>                :<span class="lineNoCov">          0 :         pc-&gt;meridian = $2;</span>
<span class="lineNum">     367 </span>                :            :       }
<span class="lineNum">     368 </span>                :<span class="lineNoCov">          0 :   | tUNUMBER ':' tUNUMBER tMERIDIAN</span>
<span class="lineNum">     369 </span>                :            :       {
<span class="lineNum">     370 </span>                :<span class="lineNoCov">          0 :         set_hhmmss (pc, $1.value, $3.value, 0, 0);</span>
<span class="lineNum">     371 </span>                :<span class="lineNoCov">          0 :         pc-&gt;meridian = $4;</span>
<span class="lineNum">     372 </span>                :            :       }
<span class="lineNum">     373 </span>                :<span class="lineNoCov">          0 :   | tUNUMBER ':' tUNUMBER ':' unsigned_seconds tMERIDIAN</span>
<span class="lineNum">     374 </span>                :            :       {
<span class="lineNum">     375 </span>                :<span class="lineNoCov">          0 :         set_hhmmss (pc, $1.value, $3.value, $5.tv_sec, $5.tv_nsec);</span>
<span class="lineNum">     376 </span>                :<span class="lineNoCov">          0 :         pc-&gt;meridian = $6;</span>
<span class="lineNum">     377 </span>                :            :       }
<span class="lineNum">     378 </span>                :<span class="lineNoCov">          0 :   | iso_8601_time</span>
<span class="lineNum">     379 </span>                :            :   ;
<span class="lineNum">     380 </span>                :            : 
<span class="lineNum">     381 </span>                :            : iso_8601_time:
<span class="lineNum">     382 </span>                :            :     tUNUMBER zone_offset
<span class="lineNum">     383 </span>                :            :       {
<span class="lineNum">     384 </span>                :<span class="lineNoCov">          0 :         set_hhmmss (pc, $1.value, 0, 0, 0);</span>
<span class="lineNum">     385 </span>                :<span class="lineNoCov">          0 :         pc-&gt;meridian = MER24;</span>
<span class="lineNum">     386 </span>                :            :       }
<span class="lineNum">     387 </span>                :<span class="lineNoCov">          0 :   | tUNUMBER ':' tUNUMBER o_zone_offset</span>
<span class="lineNum">     388 </span>                :            :       {
<span class="lineNum">     389 </span>                :<span class="lineCov">        112 :         set_hhmmss (pc, $1.value, $3.value, 0, 0);</span>
<span class="lineNum">     390 </span>                :<span class="lineCov">        112 :         pc-&gt;meridian = MER24;</span>
<span class="lineNum">     391 </span>                :            :       }
<span class="lineNum">     392 </span>                :<span class="lineCov">        112 :   | tUNUMBER ':' tUNUMBER ':' unsigned_seconds o_zone_offset</span>
<span class="lineNum">     393 </span>                :            :       {
<span class="lineNum">     394 </span>                :<span class="lineCov">        392 :         set_hhmmss (pc, $1.value, $3.value, $5.tv_sec, $5.tv_nsec);</span>
<span class="lineNum">     395 </span>                :<span class="lineCov">        392 :         pc-&gt;meridian = MER24;</span>
<span class="lineNum">     396 </span>                :            :       }
<span class="lineNum">     397 </span>                :<span class="lineCov">        392 :   ;</span>
<span class="lineNum">     398 </span>                :            : 
<span class="lineNum">     399 </span>                :            : o_zone_offset:
<span class="lineNum">     400 </span>                :            :   /* empty */
<span class="lineNum">     401 </span>                :            :   | zone_offset
<span class="lineNum">     402 </span>                :            :   ;
<span class="lineNum">     403 </span>                :            : 
<span class="lineNum">     404 </span>                :            : zone_offset:
<span class="lineNum">     405 </span>                :            :     tSNUMBER o_colon_minutes
<span class="lineNum">     406 </span>                :            :       {
<span class="lineNum">     407 </span>                :<span class="lineCov">        259 :         pc-&gt;zones_seen++;</span>
<span class="lineNum">     408 </span>                :<span class="lineCov">        259 :         pc-&gt;time_zone = time_zone_hhmm (pc, $1, $2);</span>
<span class="lineNum">     409 </span>                :            :       }
<span class="lineNum">     410 </span>                :<span class="lineCov">        259 :   ;</span>
<span class="lineNum">     411 </span>                :            : 
<span class="lineNum">     412 </span>                :            : local_zone:
<span class="lineNum">     413 </span>                :            :     tLOCAL_ZONE
<span class="lineNum">     414 </span>                :            :       {
<span class="lineNum">     415 </span>                :<span class="lineNoCov">          0 :         pc-&gt;local_isdst = $1;</span>
<span class="lineNum">     416 </span>                :<span class="lineNoCov">          0 :         pc-&gt;dsts_seen += (0 &lt; $1);</span>
<span class="lineNum">     417 </span>                :            :       }
<span class="lineNum">     418 </span>                :<span class="lineNoCov">          0 :   | tLOCAL_ZONE tDST</span>
<span class="lineNum">     419 </span>                :            :       {
<span class="lineNum">     420 </span>                :<span class="lineNoCov">          0 :         pc-&gt;local_isdst = 1;</span>
<span class="lineNum">     421 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         pc-&gt;dsts_seen += (0 &lt; $1) + 1;</span>
<span class="lineNum">     422 </span>                :            :       }
<span class="lineNum">     423 </span>                :<span class="lineNoCov">          0 :   ;</span>
<span class="lineNum">     424 </span>                :            : 
<span class="lineNum">     425 </span>                :            : /* Note 'T' is a special case, as it is used as the separator in ISO
<span class="lineNum">     426 </span>                :            :    8601 date and time of day representation. */
<span class="lineNum">     427 </span>                :            : zone:
<span class="lineNum">     428 </span>                :            :     tZONE
<span class="lineNum">     429 </span>                :<span class="lineCov">         35 :       { pc-&gt;time_zone = $1; }</span>
<span class="lineNum">     430 </span>                :<span class="lineCov">         35 :   | 'T'</span>
<span class="lineNum">     431 </span>                :<span class="lineNoCov">          0 :       { pc-&gt;time_zone = HOUR(7); }</span>
<span class="lineNum">     432 </span>                :<span class="lineNoCov">          0 :   | tZONE relunit_snumber</span>
<span class="lineNum">     433 </span>                :<span class="lineCov">         42 :       { pc-&gt;time_zone = $1;</span>
<span class="lineNum">     434 </span>                :<span class="lineCov">         42 :         apply_relative_time (pc, $2, 1); }</span>
<span class="lineNum">     435 </span>                :<span class="lineCov">         42 :   | 'T' relunit_snumber</span>
<span class="lineNum">     436 </span>                :<span class="lineNoCov">          0 :       { pc-&gt;time_zone = HOUR(7);</span>
<span class="lineNum">     437 </span>                :<span class="lineNoCov">          0 :         apply_relative_time (pc, $2, 1); }</span>
<span class="lineNum">     438 </span>                :<span class="lineNoCov">          0 :   | tZONE tSNUMBER o_colon_minutes</span>
<span class="lineNum">     439 </span>                :<span class="lineCov">        203 :       { pc-&gt;time_zone = $1 + time_zone_hhmm (pc, $2, $3); }</span>
<span class="lineNum">     440 </span>                :<span class="lineCov">        203 :   | tDAYZONE</span>
<span class="lineNum">     441 </span>                :<span class="lineNoCov">          0 :       { pc-&gt;time_zone = $1 + 60; }</span>
<span class="lineNum">     442 </span>                :<span class="lineNoCov">          0 :   | tZONE tDST</span>
<span class="lineNum">     443 </span>                :<span class="lineNoCov">          0 :       { pc-&gt;time_zone = $1 + 60; }</span>
<span class="lineNum">     444 </span>                :<span class="lineNoCov">          0 :   ;</span>
<span class="lineNum">     445 </span>                :            : 
<span class="lineNum">     446 </span>                :            : day:
<span class="lineNum">     447 </span>                :            :     tDAY
<span class="lineNum">     448 </span>                :            :       {
<span class="lineNum">     449 </span>                :<span class="lineCov">         28 :         pc-&gt;day_ordinal = 0;</span>
<span class="lineNum">     450 </span>                :<span class="lineCov">         28 :         pc-&gt;day_number = $1;</span>
<span class="lineNum">     451 </span>                :            :       }
<span class="lineNum">     452 </span>                :<span class="lineCov">         28 :   | tDAY ','</span>
<span class="lineNum">     453 </span>                :            :       {
<span class="lineNum">     454 </span>                :<span class="lineNoCov">          0 :         pc-&gt;day_ordinal = 0;</span>
<span class="lineNum">     455 </span>                :<span class="lineNoCov">          0 :         pc-&gt;day_number = $1;</span>
<span class="lineNum">     456 </span>                :            :       }
<span class="lineNum">     457 </span>                :<span class="lineNoCov">          0 :   | tORDINAL tDAY</span>
<span class="lineNum">     458 </span>                :            :       {
<span class="lineNum">     459 </span>                :<span class="lineCov">        105 :         pc-&gt;day_ordinal = $1;</span>
<span class="lineNum">     460 </span>                :<span class="lineCov">        105 :         pc-&gt;day_number = $2;</span>
<span class="lineNum">     461 </span>                :            :       }
<span class="lineNum">     462 </span>                :<span class="lineCov">        105 :   | tUNUMBER tDAY</span>
<span class="lineNum">     463 </span>                :            :       {
<span class="lineNum">     464 </span>                :<span class="lineNoCov">          0 :         pc-&gt;day_ordinal = $1.value;</span>
<span class="lineNum">     465 </span>                :<span class="lineNoCov">          0 :         pc-&gt;day_number = $2;</span>
<span class="lineNum">     466 </span>                :            :       }
<span class="lineNum">     467 </span>                :<span class="lineNoCov">          0 :   ;</span>
<span class="lineNum">     468 </span>                :            : 
<span class="lineNum">     469 </span>                :            : date:
<span class="lineNum">     470 </span>                :            :     tUNUMBER '/' tUNUMBER
<span class="lineNum">     471 </span>                :            :       {
<span class="lineNum">     472 </span>                :<span class="lineNoCov">          0 :         pc-&gt;month = $1.value;</span>
<span class="lineNum">     473 </span>                :<span class="lineNoCov">          0 :         pc-&gt;day = $3.value;</span>
<span class="lineNum">     474 </span>                :            :       }
<span class="lineNum">     475 </span>                :<span class="lineNoCov">          0 :   | tUNUMBER '/' tUNUMBER '/' tUNUMBER</span>
<span class="lineNum">     476 </span>                :            :       {
<span class="lineNum">     477 </span>                :            :         /* Interpret as YYYY/MM/DD if the first value has 4 or more digits,
<span class="lineNum">     478 </span>                :            :            otherwise as MM/DD/YY.
<span class="lineNum">     479 </span>                :            :            The goal in recognizing YYYY/MM/DD is solely to support legacy
<span class="lineNum">     480 </span>                :            :            machine-generated dates like those in an RCS log listing.  If
<span class="lineNum">     481 </span>                :            :            you want portability, use the ISO 8601 format.  */
<span class="lineNum">     482 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 21 times"> + </span>]:<span class="lineCov">         21 :         if (4 &lt;= $1.digits)</span>
<span class="lineNum">     483 </span>                :            :           {
<span class="lineNum">     484 </span>                :<span class="lineNoCov">          0 :             pc-&gt;year = $1;</span>
<span class="lineNum">     485 </span>                :<span class="lineNoCov">          0 :             pc-&gt;month = $3.value;</span>
<span class="lineNum">     486 </span>                :<span class="lineNoCov">          0 :             pc-&gt;day = $5.value;</span>
<span class="lineNum">     487 </span>                :            :           }
<span class="lineNum">     488 </span>                :            :         else
<span class="lineNum">     489 </span>                :            :           {
<span class="lineNum">     490 </span>                :<span class="lineCov">         21 :             pc-&gt;month = $1.value;</span>
<span class="lineNum">     491 </span>                :<span class="lineCov">         21 :             pc-&gt;day = $3.value;</span>
<span class="lineNum">     492 </span>                :<span class="lineCov">         21 :             pc-&gt;year = $5;</span>
<span class="lineNum">     493 </span>                :            :           }
<span class="lineNum">     494 </span>                :            :       }
<span class="lineNum">     495 </span>                :<span class="lineCov">         21 :   | tUNUMBER tMONTH tSNUMBER</span>
<span class="lineNum">     496 </span>                :            :       {
<span class="lineNum">     497 </span>                :            :         /* e.g. 17-JUN-1992.  */
<span class="lineNum">     498 </span>                :<span class="lineNoCov">          0 :         pc-&gt;day = $1.value;</span>
<span class="lineNum">     499 </span>                :<span class="lineNoCov">          0 :         pc-&gt;month = $2;</span>
<span class="lineNum">     500 </span>                :<span class="lineNoCov">          0 :         pc-&gt;year.value = -$3.value;</span>
<span class="lineNum">     501 </span>                :<span class="lineNoCov">          0 :         pc-&gt;year.digits = $3.digits;</span>
<span class="lineNum">     502 </span>                :            :       }
<span class="lineNum">     503 </span>                :<span class="lineNoCov">          0 :   | tMONTH tSNUMBER tSNUMBER</span>
<span class="lineNum">     504 </span>                :            :       {
<span class="lineNum">     505 </span>                :            :         /* e.g. JUN-17-1992.  */
<span class="lineNum">     506 </span>                :<span class="lineCov">         14 :         pc-&gt;month = $1;</span>
<span class="lineNum">     507 </span>                :<span class="lineCov">         14 :         pc-&gt;day = -$2.value;</span>
<span class="lineNum">     508 </span>                :<span class="lineCov">         14 :         pc-&gt;year.value = -$3.value;</span>
<span class="lineNum">     509 </span>                :<span class="lineCov">         14 :         pc-&gt;year.digits = $3.digits;</span>
<span class="lineNum">     510 </span>                :            :       }
<span class="lineNum">     511 </span>                :<span class="lineCov">         14 :   | tMONTH tUNUMBER</span>
<span class="lineNum">     512 </span>                :            :       {
<span class="lineNum">     513 </span>                :<span class="lineCov">          7 :         pc-&gt;month = $1;</span>
<span class="lineNum">     514 </span>                :<span class="lineCov">          7 :         pc-&gt;day = $2.value;</span>
<span class="lineNum">     515 </span>                :            :       }
<span class="lineNum">     516 </span>                :<span class="lineCov">          7 :   | tMONTH tUNUMBER ',' tUNUMBER</span>
<span class="lineNum">     517 </span>                :            :       {
<span class="lineNum">     518 </span>                :<span class="lineNoCov">          0 :         pc-&gt;month = $1;</span>
<span class="lineNum">     519 </span>                :<span class="lineNoCov">          0 :         pc-&gt;day = $2.value;</span>
<span class="lineNum">     520 </span>                :<span class="lineNoCov">          0 :         pc-&gt;year = $4;</span>
<span class="lineNum">     521 </span>                :            :       }
<span class="lineNum">     522 </span>                :<span class="lineNoCov">          0 :   | tUNUMBER tMONTH</span>
<span class="lineNum">     523 </span>                :            :       {
<span class="lineNum">     524 </span>                :<span class="lineNoCov">          0 :         pc-&gt;day = $1.value;</span>
<span class="lineNum">     525 </span>                :<span class="lineNoCov">          0 :         pc-&gt;month = $2;</span>
<span class="lineNum">     526 </span>                :            :       }
<span class="lineNum">     527 </span>                :<span class="lineNoCov">          0 :   | tUNUMBER tMONTH tUNUMBER</span>
<span class="lineNum">     528 </span>                :            :       {
<span class="lineNum">     529 </span>                :<span class="lineNoCov">          0 :         pc-&gt;day = $1.value;</span>
<span class="lineNum">     530 </span>                :<span class="lineNoCov">          0 :         pc-&gt;month = $2;</span>
<span class="lineNum">     531 </span>                :<span class="lineNoCov">          0 :         pc-&gt;year = $3;</span>
<span class="lineNum">     532 </span>                :            :       }
<span class="lineNum">     533 </span>                :<span class="lineNoCov">          0 :   | iso_8601_date</span>
<span class="lineNum">     534 </span>                :            :   ;
<span class="lineNum">     535 </span>                :            : 
<span class="lineNum">     536 </span>                :            : iso_8601_date:
<span class="lineNum">     537 </span>                :            :     tUNUMBER tSNUMBER tSNUMBER
<span class="lineNum">     538 </span>                :            :       {
<span class="lineNum">     539 </span>                :            :         /* ISO 8601 format.  YYYY-MM-DD.  */
<span class="lineNum">     540 </span>                :<span class="lineCov">       3220 :         pc-&gt;year = $1;</span>
<span class="lineNum">     541 </span>                :<span class="lineCov">       3220 :         pc-&gt;month = -$2.value;</span>
<span class="lineNum">     542 </span>                :<span class="lineCov">       3220 :         pc-&gt;day = -$3.value;</span>
<span class="lineNum">     543 </span>                :            :       }
<span class="lineNum">     544 </span>                :<span class="lineCov">       3220 :   ;</span>
<span class="lineNum">     545 </span>                :            : 
<span class="lineNum">     546 </span>                :            : rel:
<span class="lineNum">     547 </span>                :            :     relunit tAGO
<span class="lineNum">     548 </span>                :<span class="lineCov">         77 :       { apply_relative_time (pc, $1, $2); }</span>
<span class="lineNum">     549 </span>                :<span class="lineCov">         77 :   | relunit</span>
<span class="lineNum">     550 </span>                :<span class="lineCov">       2842 :       { apply_relative_time (pc, $1, 1); }</span>
<span class="lineNum">     551 </span>                :<span class="lineCov">       2842 :   | dayshift</span>
<span class="lineNum">     552 </span>                :<span class="lineCov">         98 :       { apply_relative_time (pc, $1, 1); }</span>
<span class="lineNum">     553 </span>                :<span class="lineCov">         98 :   ;</span>
<span class="lineNum">     554 </span>                :            : 
<span class="lineNum">     555 </span>                :            : relunit:
<span class="lineNum">     556 </span>                :            :     tORDINAL tYEAR_UNIT
<span class="lineNum">     557 </span>                :<span class="lineCov">         14 :       { $$ = RELATIVE_TIME_0; $$.year = $1; }</span>
<span class="lineNum">     558 </span>                :<span class="lineCov">         14 :   | tUNUMBER tYEAR_UNIT</span>
<span class="lineNum">     559 </span>                :<span class="lineCov">         21 :       { $$ = RELATIVE_TIME_0; $$.year = $1.value; }</span>
<span class="lineNum">     560 </span>                :<span class="lineCov">         21 :   | tYEAR_UNIT</span>
<span class="lineNum">     561 </span>                :<span class="lineNoCov">          0 :       { $$ = RELATIVE_TIME_0; $$.year = 1; }</span>
<span class="lineNum">     562 </span>                :<span class="lineNoCov">          0 :   | tORDINAL tMONTH_UNIT</span>
<span class="lineNum">     563 </span>                :<span class="lineCov">         14 :       { $$ = RELATIVE_TIME_0; $$.month = $1; }</span>
<span class="lineNum">     564 </span>                :<span class="lineCov">         14 :   | tUNUMBER tMONTH_UNIT</span>
<span class="lineNum">     565 </span>                :<span class="lineCov">          7 :       { $$ = RELATIVE_TIME_0; $$.month = $1.value; }</span>
<span class="lineNum">     566 </span>                :<span class="lineCov">          7 :   | tMONTH_UNIT</span>
<span class="lineNum">     567 </span>                :<span class="lineNoCov">          0 :       { $$ = RELATIVE_TIME_0; $$.month = 1; }</span>
<span class="lineNum">     568 </span>                :<span class="lineNoCov">          0 :   | tORDINAL tDAY_UNIT</span>
<span class="lineNum">     569 </span>                :<span class="lineCov">         21 :       { $$ = RELATIVE_TIME_0; $$.day = $1 * $2; }</span>
<span class="lineNum">     570 </span>                :<span class="lineCov">         21 :   | tUNUMBER tDAY_UNIT</span>
<span class="lineNum">     571 </span>                :<span class="lineCov">         42 :       { $$ = RELATIVE_TIME_0; $$.day = $1.value * $2; }</span>
<span class="lineNum">     572 </span>                :<span class="lineCov">         42 :   | tDAY_UNIT</span>
<span class="lineNum">     573 </span>                :<span class="lineNoCov">          0 :       { $$ = RELATIVE_TIME_0; $$.day = $1; }</span>
<span class="lineNum">     574 </span>                :<span class="lineNoCov">          0 :   | tORDINAL tHOUR_UNIT</span>
<span class="lineNum">     575 </span>                :<span class="lineCov">         14 :       { $$ = RELATIVE_TIME_0; $$.hour = $1; }</span>
<span class="lineNum">     576 </span>                :<span class="lineCov">         14 :   | tUNUMBER tHOUR_UNIT</span>
<span class="lineNum">     577 </span>                :<span class="lineCov">         14 :       { $$ = RELATIVE_TIME_0; $$.hour = $1.value; }</span>
<span class="lineNum">     578 </span>                :<span class="lineCov">         14 :   | tHOUR_UNIT</span>
<span class="lineNum">     579 </span>                :<span class="lineNoCov">          0 :       { $$ = RELATIVE_TIME_0; $$.hour = 1; }</span>
<span class="lineNum">     580 </span>                :<span class="lineNoCov">          0 :   | tORDINAL tMINUTE_UNIT</span>
<span class="lineNum">     581 </span>                :<span class="lineCov">         14 :       { $$ = RELATIVE_TIME_0; $$.minutes = $1; }</span>
<span class="lineNum">     582 </span>                :<span class="lineCov">         14 :   | tUNUMBER tMINUTE_UNIT</span>
<span class="lineNum">     583 </span>                :<span class="lineCov">          7 :       { $$ = RELATIVE_TIME_0; $$.minutes = $1.value; }</span>
<span class="lineNum">     584 </span>                :<span class="lineCov">          7 :   | tMINUTE_UNIT</span>
<span class="lineNum">     585 </span>                :<span class="lineNoCov">          0 :       { $$ = RELATIVE_TIME_0; $$.minutes = 1; }</span>
<span class="lineNum">     586 </span>                :<span class="lineNoCov">          0 :   | tORDINAL tSEC_UNIT</span>
<span class="lineNum">     587 </span>                :<span class="lineCov">          7 :       { $$ = RELATIVE_TIME_0; $$.seconds = $1; }</span>
<span class="lineNum">     588 </span>                :<span class="lineCov">          7 :   | tUNUMBER tSEC_UNIT</span>
<span class="lineNum">     589 </span>                :<span class="lineCov">         21 :       { $$ = RELATIVE_TIME_0; $$.seconds = $1.value; }</span>
<span class="lineNum">     590 </span>                :<span class="lineCov">         21 :   | tSDECIMAL_NUMBER tSEC_UNIT</span>
<span class="lineNum">     591 </span>                :<span class="lineCov">         14 :       { $$ = RELATIVE_TIME_0; $$.seconds = $1.tv_sec; $$.ns = $1.tv_nsec; }</span>
<span class="lineNum">     592 </span>                :<span class="lineCov">         14 :   | tUDECIMAL_NUMBER tSEC_UNIT</span>
<span class="lineNum">     593 </span>                :<span class="lineNoCov">          0 :       { $$ = RELATIVE_TIME_0; $$.seconds = $1.tv_sec; $$.ns = $1.tv_nsec; }</span>
<span class="lineNum">     594 </span>                :<span class="lineNoCov">          0 :   | tSEC_UNIT</span>
<span class="lineNum">     595 </span>                :<span class="lineNoCov">          0 :       { $$ = RELATIVE_TIME_0; $$.seconds = 1; }</span>
<span class="lineNum">     596 </span>                :<span class="lineNoCov">          0 :   | relunit_snumber</span>
<span class="lineNum">     597 </span>                :            :   ;
<span class="lineNum">     598 </span>                :            : 
<span class="lineNum">     599 </span>                :            : relunit_snumber:
<span class="lineNum">     600 </span>                :            :     tSNUMBER tYEAR_UNIT
<span class="lineNum">     601 </span>                :<span class="lineNoCov">          0 :       { $$ = RELATIVE_TIME_0; $$.year = $1.value; }</span>
<span class="lineNum">     602 </span>                :<span class="lineNoCov">          0 :   | tSNUMBER tMONTH_UNIT</span>
<span class="lineNum">     603 </span>                :<span class="lineCov">         84 :       { $$ = RELATIVE_TIME_0; $$.month = $1.value; }</span>
<span class="lineNum">     604 </span>                :<span class="lineCov">         84 :   | tSNUMBER tDAY_UNIT</span>
<span class="lineNum">     605 </span>                :<span class="lineCov">       2590 :       { $$ = RELATIVE_TIME_0; $$.day = $1.value * $2; }</span>
<span class="lineNum">     606 </span>                :<span class="lineCov">       2590 :   | tSNUMBER tHOUR_UNIT</span>
<span class="lineNum">     607 </span>                :<span class="lineCov">         63 :       { $$ = RELATIVE_TIME_0; $$.hour = $1.value; }</span>
<span class="lineNum">     608 </span>                :<span class="lineCov">         63 :   | tSNUMBER tMINUTE_UNIT</span>
<span class="lineNum">     609 </span>                :<span class="lineCov">          7 :       { $$ = RELATIVE_TIME_0; $$.minutes = $1.value; }</span>
<span class="lineNum">     610 </span>                :<span class="lineCov">          7 :   | tSNUMBER tSEC_UNIT</span>
<span class="lineNum">     611 </span>                :<span class="lineCov">         14 :       { $$ = RELATIVE_TIME_0; $$.seconds = $1.value; }</span>
<span class="lineNum">     612 </span>                :<span class="lineCov">         14 :   ;</span>
<span class="lineNum">     613 </span>                :            : 
<span class="lineNum">     614 </span>                :            : dayshift:
<span class="lineNum">     615 </span>                :            :     tDAY_SHIFT
<span class="lineNum">     616 </span>                :<span class="lineCov">         98 :       { $$ = RELATIVE_TIME_0; $$.day = $1; }</span>
<span class="lineNum">     617 </span>                :<span class="lineCov">         98 :   ;</span>
<span class="lineNum">     618 </span>                :            : 
<span class="lineNum">     619 </span>                :            : seconds: signed_seconds | unsigned_seconds;
<span class="lineNum">     620 </span>                :            : 
<span class="lineNum">     621 </span>                :            : signed_seconds:
<span class="lineNum">     622 </span>                :            :     tSDECIMAL_NUMBER
<span class="lineNum">     623 </span>                :            :   | tSNUMBER
<span class="lineNum">     624 </span>                :<span class="lineCov">         14 :       { $$.tv_sec = $1.value; $$.tv_nsec = 0; }</span>
<span class="lineNum">     625 </span>                :<span class="lineCov">         14 :   ;</span>
<span class="lineNum">     626 </span>                :            : 
<span class="lineNum">     627 </span>                :            : unsigned_seconds:
<span class="lineNum">     628 </span>                :            :     tUDECIMAL_NUMBER
<span class="lineNum">     629 </span>                :            :   | tUNUMBER
<span class="lineNum">     630 </span>                :<span class="lineCov">        371 :       { $$.tv_sec = $1.value; $$.tv_nsec = 0; }</span>
<span class="lineNum">     631 </span>                :<span class="lineCov">        371 :   ;</span>
<span class="lineNum">     632 </span>                :            : 
<span class="lineNum">     633 </span>                :            : number:
<span class="lineNum">     634 </span>                :            :     tUNUMBER
<span class="lineNum">     635 </span>                :<span class="lineCov">         28 :       { digits_to_date_time (pc, $1); }</span>
<span class="lineNum">     636 </span>                :<span class="lineCov">         28 :   ;</span>
<span class="lineNum">     637 </span>                :            : 
<span class="lineNum">     638 </span>                :            : hybrid:
<span class="lineNum">     639 </span>                :            :     tUNUMBER relunit_snumber
<span class="lineNum">     640 </span>                :            :       {
<span class="lineNum">     641 </span>                :            :         /* Hybrid all-digit and relative offset, so that we accept e.g.,
<span class="lineNum">     642 </span>                :            :            &quot;YYYYMMDD +N days&quot; as well as &quot;YYYYMMDD N days&quot;.  */
<span class="lineNum">     643 </span>                :<span class="lineCov">          7 :         digits_to_date_time (pc, $1);</span>
<span class="lineNum">     644 </span>                :<span class="lineCov">          7 :         apply_relative_time (pc, $2, 1);</span>
<span class="lineNum">     645 </span>                :            :       }
<span class="lineNum">     646 </span>                :<span class="lineCov">          7 :   ;</span>
<span class="lineNum">     647 </span>                :            : 
<span class="lineNum">     648 </span>                :            : o_colon_minutes:
<span class="lineNum">     649 </span>                :            :     /* empty */
<span class="lineNum">     650 </span>                :<span class="lineCov">        364 :       { $$ = -1; }</span>
<span class="lineNum">     651 </span>                :<span class="lineCov">        364 :   | ':' tUNUMBER</span>
<span class="lineNum">     652 </span>                :<span class="lineCov">         98 :       { $$ = $2.value; }</span>
<span class="lineNum">     653 </span>                :<span class="lineCov">         98 :   ;</span>
<span class="lineNum">     654 </span>                :            : 
<span class="lineNum">     655 </span>                :            : %%
<span class="lineNum">     656 </span>                :            : 
<span class="lineNum">     657 </span>                :            : static table const meridian_table[] =
<span class="lineNum">     658 </span>                :            : {
<span class="lineNum">     659 </span>                :            :   { &quot;AM&quot;,   tMERIDIAN, MERam },
<span class="lineNum">     660 </span>                :            :   { &quot;A.M.&quot;, tMERIDIAN, MERam },
<span class="lineNum">     661 </span>                :            :   { &quot;PM&quot;,   tMERIDIAN, MERpm },
<span class="lineNum">     662 </span>                :            :   { &quot;P.M.&quot;, tMERIDIAN, MERpm },
<span class="lineNum">     663 </span>                :            :   { NULL, 0, 0 }
<span class="lineNum">     664 </span>                :            : };
<span class="lineNum">     665 </span>                :            : 
<span class="lineNum">     666 </span>                :            : static table const dst_table[] =
<span class="lineNum">     667 </span>                :            : {
<span class="lineNum">     668 </span>                :            :   { &quot;DST&quot;, tDST, 0 }
<span class="lineNum">     669 </span>                :            : };
<span class="lineNum">     670 </span>                :            : 
<span class="lineNum">     671 </span>                :            : static table const month_and_day_table[] =
<span class="lineNum">     672 </span>                :            : {
<span class="lineNum">     673 </span>                :            :   { &quot;JANUARY&quot;,  tMONTH,  1 },
<span class="lineNum">     674 </span>                :            :   { &quot;FEBRUARY&quot;, tMONTH,  2 },
<span class="lineNum">     675 </span>                :            :   { &quot;MARCH&quot;,    tMONTH,  3 },
<span class="lineNum">     676 </span>                :            :   { &quot;APRIL&quot;,    tMONTH,  4 },
<span class="lineNum">     677 </span>                :            :   { &quot;MAY&quot;,      tMONTH,  5 },
<span class="lineNum">     678 </span>                :            :   { &quot;JUNE&quot;,     tMONTH,  6 },
<span class="lineNum">     679 </span>                :            :   { &quot;JULY&quot;,     tMONTH,  7 },
<span class="lineNum">     680 </span>                :            :   { &quot;AUGUST&quot;,   tMONTH,  8 },
<span class="lineNum">     681 </span>                :            :   { &quot;SEPTEMBER&quot;,tMONTH,  9 },
<span class="lineNum">     682 </span>                :            :   { &quot;SEPT&quot;,     tMONTH,  9 },
<span class="lineNum">     683 </span>                :            :   { &quot;OCTOBER&quot;,  tMONTH, 10 },
<span class="lineNum">     684 </span>                :            :   { &quot;NOVEMBER&quot;, tMONTH, 11 },
<span class="lineNum">     685 </span>                :            :   { &quot;DECEMBER&quot;, tMONTH, 12 },
<span class="lineNum">     686 </span>                :            :   { &quot;SUNDAY&quot;,   tDAY,    0 },
<span class="lineNum">     687 </span>                :            :   { &quot;MONDAY&quot;,   tDAY,    1 },
<span class="lineNum">     688 </span>                :            :   { &quot;TUESDAY&quot;,  tDAY,    2 },
<span class="lineNum">     689 </span>                :            :   { &quot;TUES&quot;,     tDAY,    2 },
<span class="lineNum">     690 </span>                :            :   { &quot;WEDNESDAY&quot;,tDAY,    3 },
<span class="lineNum">     691 </span>                :            :   { &quot;WEDNES&quot;,   tDAY,    3 },
<span class="lineNum">     692 </span>                :            :   { &quot;THURSDAY&quot;, tDAY,    4 },
<span class="lineNum">     693 </span>                :            :   { &quot;THUR&quot;,     tDAY,    4 },
<span class="lineNum">     694 </span>                :            :   { &quot;THURS&quot;,    tDAY,    4 },
<span class="lineNum">     695 </span>                :            :   { &quot;FRIDAY&quot;,   tDAY,    5 },
<span class="lineNum">     696 </span>                :            :   { &quot;SATURDAY&quot;, tDAY,    6 },
<span class="lineNum">     697 </span>                :            :   { NULL, 0, 0 }
<span class="lineNum">     698 </span>                :            : };
<span class="lineNum">     699 </span>                :            : 
<span class="lineNum">     700 </span>                :            : static table const time_units_table[] =
<span class="lineNum">     701 </span>                :            : {
<span class="lineNum">     702 </span>                :            :   { &quot;YEAR&quot;,     tYEAR_UNIT,      1 },
<span class="lineNum">     703 </span>                :            :   { &quot;MONTH&quot;,    tMONTH_UNIT,     1 },
<span class="lineNum">     704 </span>                :            :   { &quot;FORTNIGHT&quot;,tDAY_UNIT,      14 },
<span class="lineNum">     705 </span>                :            :   { &quot;WEEK&quot;,     tDAY_UNIT,       7 },
<span class="lineNum">     706 </span>                :            :   { &quot;DAY&quot;,      tDAY_UNIT,       1 },
<span class="lineNum">     707 </span>                :            :   { &quot;HOUR&quot;,     tHOUR_UNIT,      1 },
<span class="lineNum">     708 </span>                :            :   { &quot;MINUTE&quot;,   tMINUTE_UNIT,    1 },
<span class="lineNum">     709 </span>                :            :   { &quot;MIN&quot;,      tMINUTE_UNIT,    1 },
<span class="lineNum">     710 </span>                :            :   { &quot;SECOND&quot;,   tSEC_UNIT,       1 },
<span class="lineNum">     711 </span>                :            :   { &quot;SEC&quot;,      tSEC_UNIT,       1 },
<span class="lineNum">     712 </span>                :            :   { NULL, 0, 0 }
<span class="lineNum">     713 </span>                :            : };
<span class="lineNum">     714 </span>                :            : 
<span class="lineNum">     715 </span>                :            : /* Assorted relative-time words. */
<span class="lineNum">     716 </span>                :            : static table const relative_time_table[] =
<span class="lineNum">     717 </span>                :            : {
<span class="lineNum">     718 </span>                :            :   { &quot;TOMORROW&quot;, tDAY_SHIFT,      1 },
<span class="lineNum">     719 </span>                :            :   { &quot;YESTERDAY&quot;,tDAY_SHIFT,     -1 },
<span class="lineNum">     720 </span>                :            :   { &quot;TODAY&quot;,    tDAY_SHIFT,      0 },
<span class="lineNum">     721 </span>                :            :   { &quot;NOW&quot;,      tDAY_SHIFT,      0 },
<span class="lineNum">     722 </span>                :            :   { &quot;LAST&quot;,     tORDINAL,       -1 },
<span class="lineNum">     723 </span>                :            :   { &quot;THIS&quot;,     tORDINAL,        0 },
<span class="lineNum">     724 </span>                :            :   { &quot;NEXT&quot;,     tORDINAL,        1 },
<span class="lineNum">     725 </span>                :            :   { &quot;FIRST&quot;,    tORDINAL,        1 },
<span class="lineNum">     726 </span>                :            : /*{ &quot;SECOND&quot;,   tORDINAL,        2 }, */
<span class="lineNum">     727 </span>                :            :   { &quot;THIRD&quot;,    tORDINAL,        3 },
<span class="lineNum">     728 </span>                :            :   { &quot;FOURTH&quot;,   tORDINAL,        4 },
<span class="lineNum">     729 </span>                :            :   { &quot;FIFTH&quot;,    tORDINAL,        5 },
<span class="lineNum">     730 </span>                :            :   { &quot;SIXTH&quot;,    tORDINAL,        6 },
<span class="lineNum">     731 </span>                :            :   { &quot;SEVENTH&quot;,  tORDINAL,        7 },
<span class="lineNum">     732 </span>                :            :   { &quot;EIGHTH&quot;,   tORDINAL,        8 },
<span class="lineNum">     733 </span>                :            :   { &quot;NINTH&quot;,    tORDINAL,        9 },
<span class="lineNum">     734 </span>                :            :   { &quot;TENTH&quot;,    tORDINAL,       10 },
<span class="lineNum">     735 </span>                :            :   { &quot;ELEVENTH&quot;, tORDINAL,       11 },
<span class="lineNum">     736 </span>                :            :   { &quot;TWELFTH&quot;,  tORDINAL,       12 },
<span class="lineNum">     737 </span>                :            :   { &quot;AGO&quot;,      tAGO,           -1 },
<span class="lineNum">     738 </span>                :            :   { &quot;HENCE&quot;,    tAGO,            1 },
<span class="lineNum">     739 </span>                :            :   { NULL, 0, 0 }
<span class="lineNum">     740 </span>                :            : };
<span class="lineNum">     741 </span>                :            : 
<span class="lineNum">     742 </span>                :            : /* The universal time zone table.  These labels can be used even for
<span class="lineNum">     743 </span>                :            :    time stamps that would not otherwise be valid, e.g., GMT time
<span class="lineNum">     744 </span>                :            :    stamps in London during summer.  */
<span class="lineNum">     745 </span>                :            : static table const universal_time_zone_table[] =
<span class="lineNum">     746 </span>                :            : {
<span class="lineNum">     747 </span>                :            :   { &quot;GMT&quot;,      tZONE,     HOUR ( 0) }, /* Greenwich Mean */
<span class="lineNum">     748 </span>                :            :   { &quot;UT&quot;,       tZONE,     HOUR ( 0) }, /* Universal (Coordinated) */
<span class="lineNum">     749 </span>                :            :   { &quot;UTC&quot;,      tZONE,     HOUR ( 0) },
<span class="lineNum">     750 </span>                :            :   { NULL, 0, 0 }
<span class="lineNum">     751 </span>                :            : };
<span class="lineNum">     752 </span>                :            : 
<span class="lineNum">     753 </span>                :            : /* The time zone table.  This table is necessarily incomplete, as time
<span class="lineNum">     754 </span>                :            :    zone abbreviations are ambiguous; e.g. Australians interpret &quot;EST&quot;
<span class="lineNum">     755 </span>                :            :    as Eastern time in Australia, not as US Eastern Standard Time.
<span class="lineNum">     756 </span>                :            :    You cannot rely on parse_datetime to handle arbitrary time zone
<span class="lineNum">     757 </span>                :            :    abbreviations; use numeric abbreviations like &quot;-0500&quot; instead.  */
<span class="lineNum">     758 </span>                :            : static table const time_zone_table[] =
<span class="lineNum">     759 </span>                :            : {
<span class="lineNum">     760 </span>                :            :   { &quot;WET&quot;,      tZONE,     HOUR ( 0) }, /* Western European */
<span class="lineNum">     761 </span>                :            :   { &quot;WEST&quot;,     tDAYZONE,  HOUR ( 0) }, /* Western European Summer */
<span class="lineNum">     762 </span>                :            :   { &quot;BST&quot;,      tDAYZONE,  HOUR ( 0) }, /* British Summer */
<span class="lineNum">     763 </span>                :            :   { &quot;ART&quot;,      tZONE,    -HOUR ( 3) }, /* Argentina */
<span class="lineNum">     764 </span>                :            :   { &quot;BRT&quot;,      tZONE,    -HOUR ( 3) }, /* Brazil */
<span class="lineNum">     765 </span>                :            :   { &quot;BRST&quot;,     tDAYZONE, -HOUR ( 3) }, /* Brazil Summer */
<span class="lineNum">     766 </span>                :            :   { &quot;NST&quot;,      tZONE,   -(HOUR ( 3) + 30) },   /* Newfoundland Standard */
<span class="lineNum">     767 </span>                :            :   { &quot;NDT&quot;,      tDAYZONE,-(HOUR ( 3) + 30) },   /* Newfoundland Daylight */
<span class="lineNum">     768 </span>                :            :   { &quot;AST&quot;,      tZONE,    -HOUR ( 4) }, /* Atlantic Standard */
<span class="lineNum">     769 </span>                :            :   { &quot;ADT&quot;,      tDAYZONE, -HOUR ( 4) }, /* Atlantic Daylight */
<span class="lineNum">     770 </span>                :            :   { &quot;CLT&quot;,      tZONE,    -HOUR ( 4) }, /* Chile */
<span class="lineNum">     771 </span>                :            :   { &quot;CLST&quot;,     tDAYZONE, -HOUR ( 4) }, /* Chile Summer */
<span class="lineNum">     772 </span>                :            :   { &quot;EST&quot;,      tZONE,    -HOUR ( 5) }, /* Eastern Standard */
<span class="lineNum">     773 </span>                :            :   { &quot;EDT&quot;,      tDAYZONE, -HOUR ( 5) }, /* Eastern Daylight */
<span class="lineNum">     774 </span>                :            :   { &quot;CST&quot;,      tZONE,    -HOUR ( 6) }, /* Central Standard */
<span class="lineNum">     775 </span>                :            :   { &quot;CDT&quot;,      tDAYZONE, -HOUR ( 6) }, /* Central Daylight */
<span class="lineNum">     776 </span>                :            :   { &quot;MST&quot;,      tZONE,    -HOUR ( 7) }, /* Mountain Standard */
<span class="lineNum">     777 </span>                :            :   { &quot;MDT&quot;,      tDAYZONE, -HOUR ( 7) }, /* Mountain Daylight */
<span class="lineNum">     778 </span>                :            :   { &quot;PST&quot;,      tZONE,    -HOUR ( 8) }, /* Pacific Standard */
<span class="lineNum">     779 </span>                :            :   { &quot;PDT&quot;,      tDAYZONE, -HOUR ( 8) }, /* Pacific Daylight */
<span class="lineNum">     780 </span>                :            :   { &quot;AKST&quot;,     tZONE,    -HOUR ( 9) }, /* Alaska Standard */
<span class="lineNum">     781 </span>                :            :   { &quot;AKDT&quot;,     tDAYZONE, -HOUR ( 9) }, /* Alaska Daylight */
<span class="lineNum">     782 </span>                :            :   { &quot;HST&quot;,      tZONE,    -HOUR (10) }, /* Hawaii Standard */
<span class="lineNum">     783 </span>                :            :   { &quot;HAST&quot;,     tZONE,    -HOUR (10) }, /* Hawaii-Aleutian Standard */
<span class="lineNum">     784 </span>                :            :   { &quot;HADT&quot;,     tDAYZONE, -HOUR (10) }, /* Hawaii-Aleutian Daylight */
<span class="lineNum">     785 </span>                :            :   { &quot;SST&quot;,      tZONE,    -HOUR (12) }, /* Samoa Standard */
<span class="lineNum">     786 </span>                :            :   { &quot;WAT&quot;,      tZONE,     HOUR ( 1) }, /* West Africa */
<span class="lineNum">     787 </span>                :            :   { &quot;CET&quot;,      tZONE,     HOUR ( 1) }, /* Central European */
<span class="lineNum">     788 </span>                :            :   { &quot;CEST&quot;,     tDAYZONE,  HOUR ( 1) }, /* Central European Summer */
<span class="lineNum">     789 </span>                :            :   { &quot;MET&quot;,      tZONE,     HOUR ( 1) }, /* Middle European */
<span class="lineNum">     790 </span>                :            :   { &quot;MEZ&quot;,      tZONE,     HOUR ( 1) }, /* Middle European */
<span class="lineNum">     791 </span>                :            :   { &quot;MEST&quot;,     tDAYZONE,  HOUR ( 1) }, /* Middle European Summer */
<span class="lineNum">     792 </span>                :            :   { &quot;MESZ&quot;,     tDAYZONE,  HOUR ( 1) }, /* Middle European Summer */
<span class="lineNum">     793 </span>                :            :   { &quot;EET&quot;,      tZONE,     HOUR ( 2) }, /* Eastern European */
<span class="lineNum">     794 </span>                :            :   { &quot;EEST&quot;,     tDAYZONE,  HOUR ( 2) }, /* Eastern European Summer */
<span class="lineNum">     795 </span>                :            :   { &quot;CAT&quot;,      tZONE,     HOUR ( 2) }, /* Central Africa */
<span class="lineNum">     796 </span>                :            :   { &quot;SAST&quot;,     tZONE,     HOUR ( 2) }, /* South Africa Standard */
<span class="lineNum">     797 </span>                :            :   { &quot;EAT&quot;,      tZONE,     HOUR ( 3) }, /* East Africa */
<span class="lineNum">     798 </span>                :            :   { &quot;MSK&quot;,      tZONE,     HOUR ( 3) }, /* Moscow */
<span class="lineNum">     799 </span>                :            :   { &quot;MSD&quot;,      tDAYZONE,  HOUR ( 3) }, /* Moscow Daylight */
<span class="lineNum">     800 </span>                :            :   { &quot;IST&quot;,      tZONE,    (HOUR ( 5) + 30) },   /* India Standard */
<span class="lineNum">     801 </span>                :            :   { &quot;SGT&quot;,      tZONE,     HOUR ( 8) }, /* Singapore */
<span class="lineNum">     802 </span>                :            :   { &quot;KST&quot;,      tZONE,     HOUR ( 9) }, /* Korea Standard */
<span class="lineNum">     803 </span>                :            :   { &quot;JST&quot;,      tZONE,     HOUR ( 9) }, /* Japan Standard */
<span class="lineNum">     804 </span>                :            :   { &quot;GST&quot;,      tZONE,     HOUR (10) }, /* Guam Standard */
<span class="lineNum">     805 </span>                :            :   { &quot;NZST&quot;,     tZONE,     HOUR (12) }, /* New Zealand Standard */
<span class="lineNum">     806 </span>                :            :   { &quot;NZDT&quot;,     tDAYZONE,  HOUR (12) }, /* New Zealand Daylight */
<span class="lineNum">     807 </span>                :            :   { NULL, 0, 0 }
<span class="lineNum">     808 </span>                :            : };
<span class="lineNum">     809 </span>                :            : 
<span class="lineNum">     810 </span>                :            : /* Military time zone table.
<span class="lineNum">     811 </span>                :            : 
<span class="lineNum">     812 </span>                :            :    Note 'T' is a special case, as it is used as the separator in ISO
<span class="lineNum">     813 </span>                :            :    8601 date and time of day representation. */
<span class="lineNum">     814 </span>                :            : static table const military_table[] =
<span class="lineNum">     815 </span>                :            : {
<span class="lineNum">     816 </span>                :            :   { &quot;A&quot;, tZONE, -HOUR ( 1) },
<span class="lineNum">     817 </span>                :            :   { &quot;B&quot;, tZONE, -HOUR ( 2) },
<span class="lineNum">     818 </span>                :            :   { &quot;C&quot;, tZONE, -HOUR ( 3) },
<span class="lineNum">     819 </span>                :            :   { &quot;D&quot;, tZONE, -HOUR ( 4) },
<span class="lineNum">     820 </span>                :            :   { &quot;E&quot;, tZONE, -HOUR ( 5) },
<span class="lineNum">     821 </span>                :            :   { &quot;F&quot;, tZONE, -HOUR ( 6) },
<span class="lineNum">     822 </span>                :            :   { &quot;G&quot;, tZONE, -HOUR ( 7) },
<span class="lineNum">     823 </span>                :            :   { &quot;H&quot;, tZONE, -HOUR ( 8) },
<span class="lineNum">     824 </span>                :            :   { &quot;I&quot;, tZONE, -HOUR ( 9) },
<span class="lineNum">     825 </span>                :            :   { &quot;K&quot;, tZONE, -HOUR (10) },
<span class="lineNum">     826 </span>                :            :   { &quot;L&quot;, tZONE, -HOUR (11) },
<span class="lineNum">     827 </span>                :            :   { &quot;M&quot;, tZONE, -HOUR (12) },
<span class="lineNum">     828 </span>                :            :   { &quot;N&quot;, tZONE,  HOUR ( 1) },
<span class="lineNum">     829 </span>                :            :   { &quot;O&quot;, tZONE,  HOUR ( 2) },
<span class="lineNum">     830 </span>                :            :   { &quot;P&quot;, tZONE,  HOUR ( 3) },
<span class="lineNum">     831 </span>                :            :   { &quot;Q&quot;, tZONE,  HOUR ( 4) },
<span class="lineNum">     832 </span>                :            :   { &quot;R&quot;, tZONE,  HOUR ( 5) },
<span class="lineNum">     833 </span>                :            :   { &quot;S&quot;, tZONE,  HOUR ( 6) },
<span class="lineNum">     834 </span>                :            :   { &quot;T&quot;, 'T',    0 },
<span class="lineNum">     835 </span>                :            :   { &quot;U&quot;, tZONE,  HOUR ( 8) },
<span class="lineNum">     836 </span>                :            :   { &quot;V&quot;, tZONE,  HOUR ( 9) },
<span class="lineNum">     837 </span>                :            :   { &quot;W&quot;, tZONE,  HOUR (10) },
<span class="lineNum">     838 </span>                :            :   { &quot;X&quot;, tZONE,  HOUR (11) },
<span class="lineNum">     839 </span>                :            :   { &quot;Y&quot;, tZONE,  HOUR (12) },
<span class="lineNum">     840 </span>                :            :   { &quot;Z&quot;, tZONE,  HOUR ( 0) },
<span class="lineNum">     841 </span>                :            :   { NULL, 0, 0 }
<span class="lineNum">     842 </span>                :            : };
<span class="lineNum">     843 </span>                :            : 
<span class="lineNum">     844 </span>                :            : 
<span class="lineNum">     845 </span>                :            : 
<span class="lineNum">     846 </span>                :            : /* Convert a time zone expressed as HH:MM into an integer count of
<span class="lineNum">     847 </span>                :            :    minutes.  If MM is negative, then S is of the form HHMM and needs
<span class="lineNum">     848 </span>                :            :    to be picked apart; otherwise, S is of the form HH.  As specified in
<span class="lineNum">     849 </span>                :            :    http://www.opengroup.org/susv3xbd/xbd_chap08.html#tag_08_03, allow
<span class="lineNum">     850 </span>                :            :    only valid TZ range, and consider first two digits as hours, if no
<span class="lineNum">     851 </span>                :            :    minutes specified.  */
<a name="852"><span class="lineNum">     852 </span>                :            : </a>
<span class="lineNum">     853 </span>                :            : static long int
<span class="lineNum">     854 </span>                :<span class="lineCov">        462 : time_zone_hhmm (parser_control *pc, textint s, long int mm)</span>
<span class="lineNum">     855 </span>                :            : {
<span class="lineNum">     856 </span>                :            :   long int n_minutes;
<span class="lineNum">     857 </span>                :            : 
<span class="lineNum">     858 </span>                :            :   /* If the length of S is 1 or 2 and no minutes are specified,
<span class="lineNum">     859 </span>                :            :      interpret it as a number of hours.  */
<span class="lineNum">     860 </span>[<span class="branchCov" title="Branch 0 was taken 343 times"> + </span><span class="branchCov" title="Branch 1 was taken 119 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 245 times"> + </span><span class="branchCov" title="Branch 3 was taken 98 times"> + </span>]:<span class="lineCov">        462 :   if (s.digits &lt;= 2 &amp;&amp; mm &lt; 0)</span>
<span class="lineNum">     861 </span>                :<span class="lineCov">        245 :     s.value *= 100;</span>
<span class="lineNum">     862 </span>                :            : 
<span class="lineNum">     863 </span>        [<span class="branchCov" title="Branch 0 was taken 364 times"> + </span><span class="branchCov" title="Branch 1 was taken 98 times"> + </span>]:<span class="lineCov">        462 :   if (mm &lt; 0)</span>
<span class="lineNum">     864 </span>                :<span class="lineCov">        364 :     n_minutes = (s.value / 100) * 60 + s.value % 100;</span>
<span class="lineNum">     865 </span>                :            :   else
<span class="lineNum">     866 </span>        [<span class="branchCov" title="Branch 0 was taken 28 times"> + </span><span class="branchCov" title="Branch 1 was taken 70 times"> + </span>]:<span class="lineCov">         98 :     n_minutes = s.value * 60 + (s.negative ? -mm : mm);</span>
<span class="lineNum">     867 </span>                :            : 
<span class="lineNum">     868 </span>                :            :   /* If the absolute number of minutes is larger than 24 hours,
<span class="lineNum">     869 </span>                :            :      arrange to reject it by incrementing pc-&gt;zones_seen.  Thus,
<span class="lineNum">     870 </span>                :            :      we allow only values in the range UTC-24:00 to UTC+24:00.  */
<span class="lineNum">     871 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchCov" title="Branch 1 was taken 455 times"> + </span>]:<span class="lineCov">        462 :   if (24 * 60 &lt; abs (n_minutes))</span>
<span class="lineNum">     872 </span>                :<span class="lineCov">          7 :     pc-&gt;zones_seen++;</span>
<span class="lineNum">     873 </span>                :            : 
<span class="lineNum">     874 </span>                :<span class="lineCov">        462 :   return n_minutes;</span>
<span class="lineNum">     875 </span>                :            : }
<a name="876"><span class="lineNum">     876 </span>                :            : </a>
<span class="lineNum">     877 </span>                :            : static int
<span class="lineNum">     878 </span>                :<span class="lineCov">        735 : to_hour (long int hours, int meridian)</span>
<span class="lineNum">     879 </span>                :            : {
<span class="lineNum">     880 </span>     [<span class="branchCov" title="Branch 0 was taken 735 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">        735 :   switch (meridian)</span>
<span class="lineNum">     881 </span>                :            :     {
<span class="lineNum">     882 </span>                :            :     default: /* Pacify GCC.  */
<span class="lineNum">     883 </span>                :            :     case MER24:
<span class="lineNum">     884 </span>[<span class="branchCov" title="Branch 0 was taken 735 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 735 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        735 :       return 0 &lt;= hours &amp;&amp; hours &lt; 24 ? hours : -1;</span>
<span class="lineNum">     885 </span>                :            :     case MERam:
<span class="lineNum">     886 </span>[<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>][<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :       return 0 &lt; hours &amp;&amp; hours &lt; 12 ? hours : hours == 12 ? 0 : -1;</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<span class="lineNum">     887 </span>                :            :     case MERpm:
<span class="lineNum">     888 </span>[<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>][<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineCov">        735 :       return 0 &lt; hours &amp;&amp; hours &lt; 12 ? hours + 12 : hours == 12 ? 12 : -1;</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<span class="lineNum">     889 </span>                :            :     }
<span class="lineNum">     890 </span>                :            : }
<a name="891"><span class="lineNum">     891 </span>                :            : </a>
<span class="lineNum">     892 </span>                :            : static long int
<span class="lineNum">     893 </span>                :<span class="lineCov">       3724 : to_year (textint textyear)</span>
<span class="lineNum">     894 </span>                :            : {
<span class="lineNum">     895 </span>                :<span class="lineCov">       3724 :   long int year = textyear.value;</span>
<span class="lineNum">     896 </span>                :            : 
<span class="lineNum">     897 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 3724 times"> + </span>]:<span class="lineCov">       3724 :   if (year &lt; 0)</span>
<span class="lineNum">     898 </span>                :<span class="lineNoCov">          0 :     year = -year;</span>
<span class="lineNum">     899 </span>                :            : 
<span class="lineNum">     900 </span>                :            :   /* XPG4 suggests that years 00-68 map to 2000-2068, and
<span class="lineNum">     901 </span>                :            :      years 69-99 map to 1969-1999.  */
<span class="lineNum">     902 </span>        [<span class="branchCov" title="Branch 0 was taken 21 times"> + </span><span class="branchCov" title="Branch 1 was taken 3703 times"> + </span>]:<span class="lineCov">       3724 :   else if (textyear.digits == 2)</span>
<span class="lineNum">     903 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchCov" title="Branch 1 was taken 14 times"> + </span>]:<span class="lineCov">         21 :     year += year &lt; 69 ? 2000 : 1900;</span>
<span class="lineNum">     904 </span>                :            : 
<span class="lineNum">     905 </span>                :<span class="lineCov">       3724 :   return year;</span>
<span class="lineNum">     906 </span>                :            : }
<a name="907"><span class="lineNum">     907 </span>                :            : </a>
<span class="lineNum">     908 </span>                :            : static table const * _GL_ATTRIBUTE_PURE
<span class="lineNum">     909 </span>                :<span class="lineCov">       3710 : lookup_zone (parser_control const *pc, char const *name)</span>
<span class="lineNum">     910 </span>                :            : {
<span class="lineNum">     911 </span>                :            :   table const *tp;
<span class="lineNum">     912 </span>                :            : 
<span class="lineNum">     913 </span>        [<span class="branchCov" title="Branch 0 was taken 11130 times"> + </span><span class="branchCov" title="Branch 1 was taken 3444 times"> + </span>]:<span class="lineCov">      14574 :   for (tp = universal_time_zone_table; tp-&gt;name; tp++)</span>
<span class="lineNum">     914 </span>        [<span class="branchCov" title="Branch 0 was taken 266 times"> + </span><span class="branchCov" title="Branch 1 was taken 10864 times"> + </span>]:<span class="lineCov">      11130 :     if (strcmp (name, tp-&gt;name) == 0)</span>
<span class="lineNum">     915 </span>                :<span class="lineCov">        266 :       return tp;</span>
<span class="lineNum">     916 </span>                :            : 
<span class="lineNum">     917 </span>                :            :   /* Try local zone abbreviations before those in time_zone_table, as
<span class="lineNum">     918 </span>                :            :      the local ones are more likely to be right.  */
<span class="lineNum">     919 </span>        [<span class="branchCov" title="Branch 0 was taken 6195 times"> + </span><span class="branchCov" title="Branch 1 was taken 3444 times"> + </span>]:<span class="lineCov">       9639 :   for (tp = pc-&gt;local_time_zone_table; tp-&gt;name; tp++)</span>
<span class="lineNum">     920 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 6195 times"> + </span>]:<span class="lineCov">       6195 :     if (strcmp (name, tp-&gt;name) == 0)</span>
<span class="lineNum">     921 </span>                :<span class="lineNoCov">          0 :       return tp;</span>
<span class="lineNum">     922 </span>                :            : 
<span class="lineNum">     923 </span>        [<span class="branchCov" title="Branch 0 was taken 161868 times"> + </span><span class="branchCov" title="Branch 1 was taken 3444 times"> + </span>]:<span class="lineCov">     165312 :   for (tp = time_zone_table; tp-&gt;name; tp++)</span>
<span class="lineNum">     924 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 161868 times"> + </span>]:<span class="lineCov">     161868 :     if (strcmp (name, tp-&gt;name) == 0)</span>
<span class="lineNum">     925 </span>                :<span class="lineNoCov">          0 :       return tp;</span>
<span class="lineNum">     926 </span>                :            : 
<span class="lineNum">     927 </span>                :<span class="lineCov">       3710 :   return NULL;</span>
<span class="lineNum">     928 </span>                :            : }
<span class="lineNum">     929 </span>                :            : 
<span class="lineNum">     930 </span>                :            : #if ! HAVE_TM_GMTOFF
<span class="lineNum">     931 </span>                :            : /* Yield the difference between *A and *B,
<span class="lineNum">     932 </span>                :            :    measured in seconds, ignoring leap seconds.
<span class="lineNum">     933 </span>                :            :    The body of this function is taken directly from the GNU C Library;
<span class="lineNum">     934 </span>                :            :    see src/strftime.c.  */
<span class="lineNum">     935 </span>                :            : static long int
<span class="lineNum">     936 </span>                :            : tm_diff (struct tm const *a, struct tm const *b)
<span class="lineNum">     937 </span>                :            : {
<span class="lineNum">     938 </span>                :            :   /* Compute intervening leap days correctly even if year is negative.
<span class="lineNum">     939 </span>                :            :      Take care to avoid int overflow in leap day calculations.  */
<span class="lineNum">     940 </span>                :            :   int a4 = SHR (a-&gt;tm_year, 2) + SHR (TM_YEAR_BASE, 2) - ! (a-&gt;tm_year &amp; 3);
<span class="lineNum">     941 </span>                :            :   int b4 = SHR (b-&gt;tm_year, 2) + SHR (TM_YEAR_BASE, 2) - ! (b-&gt;tm_year &amp; 3);
<span class="lineNum">     942 </span>                :            :   int a100 = a4 / 25 - (a4 % 25 &lt; 0);
<span class="lineNum">     943 </span>                :            :   int b100 = b4 / 25 - (b4 % 25 &lt; 0);
<span class="lineNum">     944 </span>                :            :   int a400 = SHR (a100, 2);
<span class="lineNum">     945 </span>                :            :   int b400 = SHR (b100, 2);
<span class="lineNum">     946 </span>                :            :   int intervening_leap_days = (a4 - b4) - (a100 - b100) + (a400 - b400);
<span class="lineNum">     947 </span>                :            :   long int ayear = a-&gt;tm_year;
<span class="lineNum">     948 </span>                :            :   long int years = ayear - b-&gt;tm_year;
<span class="lineNum">     949 </span>                :            :   long int days = (365 * years + intervening_leap_days
<span class="lineNum">     950 </span>                :            :                    + (a-&gt;tm_yday - b-&gt;tm_yday));
<span class="lineNum">     951 </span>                :            :   return (60 * (60 * (24 * days + (a-&gt;tm_hour - b-&gt;tm_hour))
<span class="lineNum">     952 </span>                :            :                 + (a-&gt;tm_min - b-&gt;tm_min))
<span class="lineNum">     953 </span>                :            :           + (a-&gt;tm_sec - b-&gt;tm_sec));
<span class="lineNum">     954 </span>                :            : }
<span class="lineNum">     955 </span>                :            : #endif /* ! HAVE_TM_GMTOFF */
<a name="956"><span class="lineNum">     956 </span>                :            : </a>
<span class="lineNum">     957 </span>                :            : static table const *
<span class="lineNum">     958 </span>                :<span class="lineCov">       3864 : lookup_word (parser_control const *pc, char *word)</span>
<span class="lineNum">     959 </span>                :            : {
<span class="lineNum">     960 </span>                :            :   char *p;
<span class="lineNum">     961 </span>                :            :   char *q;
<span class="lineNum">     962 </span>                :            :   size_t wordlen;
<span class="lineNum">     963 </span>                :            :   table const *tp;
<span class="lineNum">     964 </span>                :            :   bool period_found;
<span class="lineNum">     965 </span>                :            :   bool abbrev;
<span class="lineNum">     966 </span>                :            : 
<span class="lineNum">     967 </span>                :            :   /* Make it uppercase.  */
<span class="lineNum">     968 </span>        [<span class="branchCov" title="Branch 0 was taken 13321 times"> + </span><span class="branchCov" title="Branch 1 was taken 3864 times"> + </span>]:<span class="lineCov">      17185 :   for (p = word; *p; p++)</span>
<span class="lineNum">     969 </span>                :            :     {
<span class="lineNum">     970 </span>                :<span class="lineCov">      13321 :       unsigned char ch = *p;</span>
<span class="lineNum">     971 </span>                :<span class="lineCov">      13321 :       *p = c_toupper (ch);</span>
<span class="lineNum">     972 </span>                :            :     }
<span class="lineNum">     973 </span>                :            : 
<span class="lineNum">     974 </span>        [<span class="branchCov" title="Branch 0 was taken 15456 times"> + </span><span class="branchCov" title="Branch 1 was taken 3864 times"> + </span>]:<span class="lineCov">      19320 :   for (tp = meridian_table; tp-&gt;name; tp++)</span>
<span class="lineNum">     975 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 15456 times"> + </span>]:<span class="lineCov">      15456 :     if (strcmp (word, tp-&gt;name) == 0)</span>
<span class="lineNum">     976 </span>                :<span class="lineNoCov">          0 :       return tp;</span>
<span class="lineNum">     977 </span>                :            : 
<span class="lineNum">     978 </span>                :            :   /* See if we have an abbreviation for a month. */
<span class="lineNum">     979 </span>                :<span class="lineCov">       3864 :   wordlen = strlen (word);</span>
<span class="lineNum">     980 </span>[<span class="branchCov" title="Branch 0 was taken 798 times"> + </span><span class="branchCov" title="Branch 1 was taken 3066 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 315 times"> + </span><span class="branchCov" title="Branch 3 was taken 483 times"> + </span>]:<span class="lineCov">       3864 :   abbrev = wordlen == 3 || (wordlen == 4 &amp;&amp; word[3] == '.');</span>
<span class="lineNum">         </span>        [<span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 315 times"> + </span>]
<span class="lineNum">     981 </span>                :            : 
<span class="lineNum">     982 </span>        [<span class="branchCov" title="Branch 0 was taken 91633 times"> + </span><span class="branchCov" title="Branch 1 was taken 3710 times"> + </span>]:<span class="lineCov">      95343 :   for (tp = month_and_day_table; tp-&gt;name; tp++)</span>
<span class="lineNum">     983 </span>[<span class="branchCov" title="Branch 0 was taken 73048 times"> + </span><span class="branchCov" title="Branch 1 was taken 18585 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 154 times"> + </span><span class="branchCov" title="Branch 3 was taken 91479 times"> + </span>]:<span class="lineCov">      91633 :     if ((abbrev ? strncmp (word, tp-&gt;name, 3) : strcmp (word, tp-&gt;name)) == 0)</span>
<span class="lineNum">     984 </span>                :<span class="lineCov">        154 :       return tp;</span>
<span class="lineNum">     985 </span>                :            : 
<span class="lineNum">     986 </span>        [<span class="branchCov" title="Branch 1 was taken 266 times"> + </span><span class="branchCov" title="Branch 2 was taken 3444 times"> + </span>]:<span class="lineCov">       3710 :   if ((tp = lookup_zone (pc, word)))</span>
<span class="lineNum">     987 </span>                :<span class="lineCov">        266 :     return tp;</span>
<span class="lineNum">     988 </span>                :            : 
<span class="lineNum">     989 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 3444 times"> + </span>]:<span class="lineCov">       3444 :   if (strcmp (word, dst_table[0].name) == 0)</span>
<span class="lineNum">     990 </span>                :<span class="lineNoCov">          0 :     return dst_table;</span>
<span class="lineNum">     991 </span>                :            : 
<span class="lineNum">     992 </span>        [<span class="branchCov" title="Branch 0 was taken 20055 times"> + </span><span class="branchCov" title="Branch 1 was taken 588 times"> + </span>]:<span class="lineCov">      20643 :   for (tp = time_units_table; tp-&gt;name; tp++)</span>
<span class="lineNum">     993 </span>        [<span class="branchCov" title="Branch 0 was taken 2856 times"> + </span><span class="branchCov" title="Branch 1 was taken 17199 times"> + </span>]:<span class="lineCov">      20055 :     if (strcmp (word, tp-&gt;name) == 0)</span>
<span class="lineNum">     994 </span>                :<span class="lineCov">       2856 :       return tp;</span>
<span class="lineNum">     995 </span>                :            : 
<span class="lineNum">     996 </span>                :            :   /* Strip off any plural and try the units table again. */
<span class="lineNum">     997 </span>        [<span class="branchCov" title="Branch 0 was taken 147 times"> + </span><span class="branchCov" title="Branch 1 was taken 441 times"> + </span>]:<span class="lineCov">        588 :   if (word[wordlen - 1] == 'S')</span>
<span class="lineNum">     998 </span>                :            :     {
<span class="lineNum">     999 </span>                :<span class="lineCov">        147 :       word[wordlen - 1] = '\0';</span>
<span class="lineNum">    1000 </span>        [<span class="branchCov" title="Branch 0 was taken 945 times"> + </span><span class="branchCov" title="Branch 1 was taken 35 times"> + </span>]:<span class="lineCov">        980 :       for (tp = time_units_table; tp-&gt;name; tp++)</span>
<span class="lineNum">    1001 </span>        [<span class="branchCov" title="Branch 0 was taken 112 times"> + </span><span class="branchCov" title="Branch 1 was taken 833 times"> + </span>]:<span class="lineCov">        945 :         if (strcmp (word, tp-&gt;name) == 0)</span>
<span class="lineNum">    1002 </span>                :<span class="lineCov">        112 :           return tp;</span>
<span class="lineNum">    1003 </span>                :<span class="lineCov">         35 :       word[wordlen - 1] = 'S';  /* For &quot;this&quot; in relative_time_table.  */</span>
<span class="lineNum">    1004 </span>                :            :     }
<span class="lineNum">    1005 </span>                :            : 
<span class="lineNum">    1006 </span>        [<span class="branchCov" title="Branch 0 was taken 4403 times"> + </span><span class="branchCov" title="Branch 1 was taken 49 times"> + </span>]:<span class="lineCov">       4452 :   for (tp = relative_time_table; tp-&gt;name; tp++)</span>
<span class="lineNum">    1007 </span>        [<span class="branchCov" title="Branch 0 was taken 427 times"> + </span><span class="branchCov" title="Branch 1 was taken 3976 times"> + </span>]:<span class="lineCov">       4403 :     if (strcmp (word, tp-&gt;name) == 0)</span>
<span class="lineNum">    1008 </span>                :<span class="lineCov">        427 :       return tp;</span>
<span class="lineNum">    1009 </span>                :            : 
<span class="lineNum">    1010 </span>                :            :   /* Military time zones. */
<span class="lineNum">    1011 </span>        [<span class="branchCov" title="Branch 0 was taken 49 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">         49 :   if (wordlen == 1)</span>
<span class="lineNum">    1012 </span>        [<span class="branchCov" title="Branch 0 was taken 1015 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1015 :     for (tp = military_table; tp-&gt;name; tp++)</span>
<span class="lineNum">    1013 </span>        [<span class="branchCov" title="Branch 0 was taken 49 times"> + </span><span class="branchCov" title="Branch 1 was taken 966 times"> + </span>]:<span class="lineCov">       1015 :       if (word[0] == tp-&gt;name[0])</span>
<span class="lineNum">    1014 </span>                :<span class="lineCov">         49 :         return tp;</span>
<span class="lineNum">    1015 </span>                :            : 
<span class="lineNum">    1016 </span>                :            :   /* Drop out any periods and try the time zone table again. */
<span class="lineNum">    1017 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (period_found = false, p = q = word; (*p = *q); q++)</span>
<span class="lineNum">    1018 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (*q == '.')</span>
<span class="lineNum">    1019 </span>                :<span class="lineNoCov">          0 :       period_found = true;</span>
<span class="lineNum">    1020 </span>                :            :     else
<span class="lineNum">    1021 </span>                :<span class="lineNoCov">          0 :       p++;</span>
<span class="lineNum">    1022 </span>[<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :   if (period_found &amp;&amp; (tp = lookup_zone (pc, word)))</span>
<span class="lineNum">    1023 </span>                :<span class="lineNoCov">          0 :     return tp;</span>
<span class="lineNum">    1024 </span>                :            : 
<span class="lineNum">    1025 </span>                :<span class="lineCov">       3864 :   return NULL;</span>
<span class="lineNum">    1026 </span>                :            : }
<a name="1027"><span class="lineNum">    1027 </span>                :            : </a>
<span class="lineNum">    1028 </span>                :            : static int
<span class="lineNum">    1029 </span>                :<span class="lineCov">      23408 : yylex (YYSTYPE *lvalp, parser_control *pc)</span>
<span class="lineNum">    1030 </span>                :            : {
<span class="lineNum">    1031 </span>                :            :   unsigned char c;
<span class="lineNum">    1032 </span>                :            :   size_t count;
<span class="lineNum">    1033 </span>                :            : 
<span class="lineNum">    1034 </span>                :            :   for (;;)
<span class="lineNum">    1035 </span>                :            :     {
<span class="lineNum">    1036 </span>        [<span class="branchCov" title="Branch 1 was taken 6916 times"> + </span><span class="branchCov" title="Branch 2 was taken 23408 times"> + </span>]:<span class="lineCov">      30324 :       while (c = *pc-&gt;input, c_isspace (c))</span>
<span class="lineNum">    1037 </span>                :<span class="lineCov">       6916 :         pc-&gt;input++;</span>
<span class="lineNum">    1038 </span>                :            : 
<span class="lineNum">    1039 </span>[<span class="branchCov" title="Branch 0 was taken 18445 times"> + </span><span class="branchCov" title="Branch 1 was taken 4963 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 11851 times"> + </span><span class="branchCov" title="Branch 3 was taken 6594 times"> + </span>]:<span class="lineCov">      23408 :       if (ISDIGIT (c) || c == '-' || c == '+')</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 4 was taken 3136 times"> + </span><span class="branchCov" title="Branch 5 was taken 8715 times"> + </span>]
<span class="lineNum">    1040 </span>                :            :         {
<span class="lineNum">    1041 </span>                :            :           char const *p;
<span class="lineNum">    1042 </span>                :            :           int sign;
<span class="lineNum">    1043 </span>                :            :           unsigned long int value;
<span class="lineNum">    1044 </span>[<span class="branchCov" title="Branch 0 was taken 8099 times"> + </span><span class="branchCov" title="Branch 1 was taken 6594 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 3136 times"> + </span><span class="branchCov" title="Branch 3 was taken 4963 times"> + </span>]:<span class="lineCov">      14693 :           if (c == '-' || c == '+')</span>
<span class="lineNum">    1045 </span>                :            :             {
<span class="lineNum">    1046 </span>        [<span class="branchCov" title="Branch 0 was taken 6594 times"> + </span><span class="branchCov" title="Branch 1 was taken 3136 times"> + </span>]:<span class="lineCov">       9730 :               sign = c == '-' ? -1 : 1;</span>
<span class="lineNum">    1047 </span>        [<span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 9730 times"> + </span>]:<span class="lineCov">       9730 :               while (c = *++pc-&gt;input, c_isspace (c))</span>
<span class="lineNum">    1048 </span>                :<span class="lineNoCov">          0 :                 continue;</span>
<span class="lineNum">    1049 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 9730 times"> + </span>]:<span class="lineCov">       9730 :               if (! ISDIGIT (c))</span>
<span class="lineNum">    1050 </span>                :            :                 /* skip the '-' sign */
<span class="lineNum">    1051 </span>                :<span class="lineNoCov">          0 :                 continue;</span>
<span class="lineNum">    1052 </span>                :            :             }
<span class="lineNum">    1053 </span>                :            :           else
<span class="lineNum">    1054 </span>                :<span class="lineCov">       4963 :             sign = 0;</span>
<span class="lineNum">    1055 </span>                :<span class="lineCov">      14693 :           p = pc-&gt;input;</span>
<span class="lineNum">    1056 </span>                :<span class="lineCov">      14693 :           for (value = 0; ; value *= 10)</span>
<span class="lineNum">    1057 </span>                :            :             {
<span class="lineNum">    1058 </span>                :<span class="lineCov">      37821 :               unsigned long int value1 = value + (c - '0');</span>
<span class="lineNum">    1059 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 37821 times"> + </span>]:<span class="lineCov">      37821 :               if (value1 &lt; value)</span>
<span class="lineNum">    1060 </span>                :<span class="lineNoCov">          0 :                 return '?';</span>
<span class="lineNum">    1061 </span>                :<span class="lineCov">      37821 :               value = value1;</span>
<span class="lineNum">    1062 </span>                :<span class="lineCov">      37821 :               c = *++p;</span>
<span class="lineNum">    1063 </span>        [<span class="branchCov" title="Branch 0 was taken 14693 times"> + </span><span class="branchCov" title="Branch 1 was taken 23128 times"> + </span>]:<span class="lineCov">      37821 :               if (! ISDIGIT (c))</span>
<span class="lineNum">    1064 </span>                :<span class="lineCov">      14693 :                 break;</span>
<span class="lineNum">    1065 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 23128 times"> + </span>]:<span class="lineCov">      23128 :               if (ULONG_MAX / 10 &lt; value)</span>
<span class="lineNum">    1066 </span>                :<span class="lineNoCov">          0 :                 return '?';</span>
<span class="lineNum">    1067 </span>                :<span class="lineCov">      23128 :             }</span>
<span class="lineNum">    1068 </span>[<span class="branchCov" title="Branch 0 was taken 14630 times"> + </span><span class="branchCov" title="Branch 1 was taken 63 times"> + </span>][<span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 14630 times"> + </span>]:<span class="lineCov">      14693 :           if ((c == '.' || c == ',') &amp;&amp; ISDIGIT (p[1]))</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 4 was taken 63 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<span class="lineNum">    1069 </span>                :            :             {
<span class="lineNum">    1070 </span>                :            :               time_t s;
<span class="lineNum">    1071 </span>                :            :               int ns;
<span class="lineNum">    1072 </span>                :            :               int digits;
<span class="lineNum">    1073 </span>                :            :               unsigned long int value1;
<span class="lineNum">    1074 </span>                :            : 
<span class="lineNum">    1075 </span>                :            :               /* Check for overflow when converting value to time_t.  */
<span class="lineNum">    1076 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 63 times"> + </span>]:<span class="lineCov">         63 :               if (sign &lt; 0)</span>
<span class="lineNum">    1077 </span>                :            :                 {
<span class="lineNum">    1078 </span>                :<span class="lineNoCov">          0 :                   s = - value;</span>
<span class="lineNum">    1079 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                   if (0 &lt; s)</span>
<span class="lineNum">    1080 </span>                :<span class="lineNoCov">          0 :                     return '?';</span>
<span class="lineNum">    1081 </span>                :<span class="lineNoCov">          0 :                   value1 = -s;</span>
<span class="lineNum">    1082 </span>                :            :                 }
<span class="lineNum">    1083 </span>                :            :               else
<span class="lineNum">    1084 </span>                :            :                 {
<span class="lineNum">    1085 </span>                :<span class="lineCov">         63 :                   s = value;</span>
<span class="lineNum">    1086 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 63 times"> + </span>]:<span class="lineCov">         63 :                   if (s &lt; 0)</span>
<span class="lineNum">    1087 </span>                :<span class="lineNoCov">          0 :                     return '?';</span>
<span class="lineNum">    1088 </span>                :<span class="lineCov">         63 :                   value1 = s;</span>
<span class="lineNum">    1089 </span>                :            :                 }
<span class="lineNum">    1090 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 63 times"> + </span>]:<span class="lineCov">         63 :               if (value != value1)</span>
<span class="lineNum">    1091 </span>                :<span class="lineNoCov">          0 :                 return '?';</span>
<span class="lineNum">    1092 </span>                :            : 
<span class="lineNum">    1093 </span>                :            :               /* Accumulate fraction, to ns precision.  */
<span class="lineNum">    1094 </span>                :<span class="lineCov">         63 :               p++;</span>
<span class="lineNum">    1095 </span>                :<span class="lineCov">         63 :               ns = *p++ - '0';</span>
<span class="lineNum">    1096 </span>        [<span class="branchCov" title="Branch 0 was taken 504 times"> + </span><span class="branchCov" title="Branch 1 was taken 63 times"> + </span>]:<span class="lineCov">        567 :               for (digits = 2; digits &lt;= LOG10_BILLION; digits++)</span>
<span class="lineNum">    1097 </span>                :            :                 {
<span class="lineNum">    1098 </span>                :<span class="lineCov">        504 :                   ns *= 10;</span>
<span class="lineNum">    1099 </span>        [<span class="branchCov" title="Branch 0 was taken 462 times"> + </span><span class="branchCov" title="Branch 1 was taken 42 times"> + </span>]:<span class="lineCov">        504 :                   if (ISDIGIT (*p))</span>
<span class="lineNum">    1100 </span>                :<span class="lineCov">        462 :                     ns += *p++ - '0';</span>
<span class="lineNum">    1101 </span>                :            :                 }
<span class="lineNum">    1102 </span>                :            : 
<span class="lineNum">    1103 </span>                :            :               /* Skip excess digits, truncating toward -Infinity.  */
<span class="lineNum">    1104 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 63 times"> + </span>]:<span class="lineCov">         63 :               if (sign &lt; 0)</span>
<span class="lineNum">    1105 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                 for (; ISDIGIT (*p); p++)</span>
<span class="lineNum">    1106 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                   if (*p != '0')</span>
<span class="lineNum">    1107 </span>                :            :                     {
<span class="lineNum">    1108 </span>                :<span class="lineNoCov">          0 :                       ns++;</span>
<span class="lineNum">    1109 </span>                :<span class="lineNoCov">          0 :                       break;</span>
<span class="lineNum">    1110 </span>                :            :                     }
<span class="lineNum">    1111 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 63 times"> + </span>]:<span class="lineCov">         63 :               while (ISDIGIT (*p))</span>
<span class="lineNum">    1112 </span>                :<span class="lineNoCov">          0 :                 p++;</span>
<span class="lineNum">    1113 </span>                :            : 
<span class="lineNum">    1114 </span>                :            :               /* Adjust to the timespec convention, which is that
<span class="lineNum">    1115 </span>                :            :                  tv_nsec is always a positive offset even if tv_sec is
<span class="lineNum">    1116 </span>                :            :                  negative.  */
<span class="lineNum">    1117 </span>[<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 63 times"> + </span>][<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineCov">         63 :               if (sign &lt; 0 &amp;&amp; ns)</span>
<span class="lineNum">    1118 </span>                :            :                 {
<span class="lineNum">    1119 </span>                :<span class="lineNoCov">          0 :                   s--;</span>
<span class="lineNum">    1120 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                   if (! (s &lt; 0))</span>
<span class="lineNum">    1121 </span>                :<span class="lineNoCov">          0 :                     return '?';</span>
<span class="lineNum">    1122 </span>                :<span class="lineNoCov">          0 :                   ns = BILLION - ns;</span>
<span class="lineNum">    1123 </span>                :            :                 }
<span class="lineNum">    1124 </span>                :            : 
<span class="lineNum">    1125 </span>                :<span class="lineCov">         63 :               lvalp-&gt;timespec.tv_sec = s;</span>
<span class="lineNum">    1126 </span>                :<span class="lineCov">         63 :               lvalp-&gt;timespec.tv_nsec = ns;</span>
<span class="lineNum">    1127 </span>                :<span class="lineCov">         63 :               pc-&gt;input = p;</span>
<span class="lineNum">    1128 </span>        [<span class="branchCov" title="Branch 0 was taken 14 times"> + </span><span class="branchCov" title="Branch 1 was taken 49 times"> + </span>]:<span class="lineCov">         63 :               return sign ? tSDECIMAL_NUMBER : tUDECIMAL_NUMBER;</span>
<span class="lineNum">    1129 </span>                :            :             }
<span class="lineNum">    1130 </span>                :            :           else
<span class="lineNum">    1131 </span>                :            :             {
<span class="lineNum">    1132 </span>                :<span class="lineCov">      14630 :               lvalp-&gt;textintval.negative = sign &lt; 0;</span>
<span class="lineNum">    1133 </span>        [<span class="branchCov" title="Branch 0 was taken 6594 times"> + </span><span class="branchCov" title="Branch 1 was taken 8036 times"> + </span>]:<span class="lineCov">      14630 :               if (sign &lt; 0)</span>
<span class="lineNum">    1134 </span>                :            :                 {
<span class="lineNum">    1135 </span>                :<span class="lineCov">       6594 :                   lvalp-&gt;textintval.value = - value;</span>
<span class="lineNum">    1136 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 6594 times"> + </span>]:<span class="lineCov">       6594 :                   if (0 &lt; lvalp-&gt;textintval.value)</span>
<span class="lineNum">    1137 </span>                :<span class="lineNoCov">          0 :                     return '?';</span>
<span class="lineNum">    1138 </span>                :            :                 }
<span class="lineNum">    1139 </span>                :            :               else
<span class="lineNum">    1140 </span>                :            :                 {
<span class="lineNum">    1141 </span>                :<span class="lineCov">       8036 :                   lvalp-&gt;textintval.value = value;</span>
<span class="lineNum">    1142 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 8036 times"> + </span>]:<span class="lineCov">       8036 :                   if (lvalp-&gt;textintval.value &lt; 0)</span>
<span class="lineNum">    1143 </span>                :<span class="lineNoCov">          0 :                     return '?';</span>
<span class="lineNum">    1144 </span>                :            :                 }
<span class="lineNum">    1145 </span>                :<span class="lineCov">      14630 :               lvalp-&gt;textintval.digits = p - pc-&gt;input;</span>
<span class="lineNum">    1146 </span>                :<span class="lineCov">      14630 :               pc-&gt;input = p;</span>
<span class="lineNum">    1147 </span>        [<span class="branchCov" title="Branch 0 was taken 9716 times"> + </span><span class="branchCov" title="Branch 1 was taken 4914 times"> + </span>]:<span class="lineCov">      14630 :               return sign ? tSNUMBER : tUNUMBER;</span>
<span class="lineNum">    1148 </span>                :            :             }
<span class="lineNum">    1149 </span>                :            :         }
<span class="lineNum">    1150 </span>                :            : 
<span class="lineNum">    1151 </span>        [<span class="branchCov" title="Branch 1 was taken 3864 times"> + </span><span class="branchCov" title="Branch 2 was taken 4851 times"> + </span>]:<span class="lineCov">       8715 :       if (c_isalpha (c))</span>
<span class="lineNum">    1152 </span>                :            :         {
<span class="lineNum">    1153 </span>                :            :           char buff[20];
<span class="lineNum">    1154 </span>                :<span class="lineCov">       3864 :           char *p = buff;</span>
<span class="lineNum">    1155 </span>                :            :           table const *tp;
<span class="lineNum">    1156 </span>                :            : 
<span class="lineNum">    1157 </span>                :            :           do
<span class="lineNum">    1158 </span>                :            :             {
<span class="lineNum">    1159 </span>        [<span class="branchCov" title="Branch 0 was taken 13321 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">      13321 :               if (p - buff &lt; sizeof buff - 1)</span>
<span class="lineNum">    1160 </span>                :<span class="lineCov">      13321 :                 *p++ = c;</span>
<span class="lineNum">    1161 </span>                :<span class="lineCov">      13321 :               c = *++pc-&gt;input;</span>
<span class="lineNum">    1162 </span>                :            :             }
<span class="lineNum">    1163 </span>[<span class="branchCov" title="Branch 1 was taken 9457 times"> + </span><span class="branchCov" title="Branch 2 was taken 3864 times"> + </span>][<span class="branchNoCov" title="Branch 3 was not taken"> - </span><span class="branchCov" title="Branch 4 was taken 3864 times"> + </span>]:<span class="lineCov">      13321 :           while (c_isalpha (c) || c == '.');</span>
<span class="lineNum">    1164 </span>                :            : 
<span class="lineNum">    1165 </span>                :<span class="lineCov">       3864 :           *p = '\0';</span>
<span class="lineNum">    1166 </span>                :<span class="lineCov">       3864 :           tp = lookup_word (pc, buff);</span>
<span class="lineNum">    1167 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 3864 times"> + </span>]:<span class="lineCov">       3864 :           if (! tp)</span>
<span class="lineNum">    1168 </span>                :<span class="lineNoCov">          0 :             return '?';</span>
<span class="lineNum">    1169 </span>                :<span class="lineCov">       3864 :           lvalp-&gt;intval = tp-&gt;value;</span>
<span class="lineNum">    1170 </span>                :<span class="lineCov">       3864 :           return tp-&gt;type;</span>
<span class="lineNum">    1171 </span>                :            :         }
<span class="lineNum">    1172 </span>                :            : 
<span class="lineNum">    1173 </span>        [<span class="branchCov" title="Branch 0 was taken 4851 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       4851 :       if (c != '(')</span>
<span class="lineNum">    1174 </span>                :<span class="lineCov">       4851 :         return *pc-&gt;input++;</span>
<span class="lineNum">    1175 </span>                :<span class="lineNoCov">          0 :       count = 0;</span>
<span class="lineNum">    1176 </span>                :            :       do
<span class="lineNum">    1177 </span>                :            :         {
<span class="lineNum">    1178 </span>                :<span class="lineNoCov">          0 :           c = *pc-&gt;input++;</span>
<span class="lineNum">    1179 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :           if (c == '\0')</span>
<span class="lineNum">    1180 </span>                :<span class="lineNoCov">          0 :             return c;</span>
<span class="lineNum">    1181 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :           if (c == '(')</span>
<span class="lineNum">    1182 </span>                :<span class="lineNoCov">          0 :             count++;</span>
<span class="lineNum">    1183 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :           else if (c == ')')</span>
<span class="lineNum">    1184 </span>                :<span class="lineNoCov">          0 :             count--;</span>
<span class="lineNum">    1185 </span>                :            :         }
<span class="lineNum">    1186 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :       while (count != 0);</span>
<span class="lineNum">    1187 </span>                :<span class="lineCov">      23408 :     }</span>
<span class="lineNum">    1188 </span>                :            : }
<span class="lineNum">    1189 </span>                :            : 
<a name="1190"><span class="lineNum">    1190 </span>                :            : /* Do nothing if the parser reports an error.  */</a>
<span class="lineNum">    1191 </span>                :            : static int
<span class="lineNum">    1192 </span>                :<span class="lineCov">         49 : yyerror (parser_control const *pc _GL_UNUSED,</span>
<span class="lineNum">    1193 </span>                :            :          char const *s _GL_UNUSED)
<span class="lineNum">    1194 </span>                :            : {
<span class="lineNum">    1195 </span>                :<span class="lineCov">         49 :   return 0;</span>
<span class="lineNum">    1196 </span>                :            : }
<span class="lineNum">    1197 </span>                :            : 
<span class="lineNum">    1198 </span>                :            : /* If *TM0 is the old and *TM1 is the new value of a struct tm after
<span class="lineNum">    1199 </span>                :            :    passing it to mktime, return true if it's OK that mktime returned T.
<span class="lineNum">    1200 </span>                :            :    It's not OK if *TM0 has out-of-range members.  */
<a name="1201"><span class="lineNum">    1201 </span>                :            : </a>
<span class="lineNum">    1202 </span>                :            : static bool
<span class="lineNum">    1203 </span>                :<span class="lineCov">       3724 : mktime_ok (struct tm const *tm0, struct tm const *tm1, time_t t)</span>
<span class="lineNum">    1204 </span>                :            : {
<span class="lineNum">    1205 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 3724 times"> + </span>]:<span class="lineCov">       3724 :   if (t == (time_t) -1)</span>
<span class="lineNum">    1206 </span>                :            :     {
<span class="lineNum">    1207 </span>                :            :       /* Guard against falsely reporting an error when parsing a time
<span class="lineNum">    1208 </span>                :            :          stamp that happens to equal (time_t) -1, on a host that
<span class="lineNum">    1209 </span>                :            :          supports such a time stamp.  */
<span class="lineNum">    1210 </span>                :<span class="lineNoCov">          0 :       tm1 = localtime (&amp;t);</span>
<span class="lineNum">    1211 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :       if (!tm1)</span>
<span class="lineNum">    1212 </span>                :<span class="lineNoCov">          0 :         return false;</span>
<span class="lineNum">    1213 </span>                :            :     }
<span class="lineNum">    1214 </span>                :            : 
<span class="lineNum">    1215 </span>                :<span class="lineCov">       3724 :   return ! ((tm0-&gt;tm_sec ^ tm1-&gt;tm_sec)</span>
<span class="lineNum">    1216 </span>                :<span class="lineCov">       3724 :             | (tm0-&gt;tm_min ^ tm1-&gt;tm_min)</span>
<span class="lineNum">    1217 </span>                :<span class="lineCov">       3724 :             | (tm0-&gt;tm_hour ^ tm1-&gt;tm_hour)</span>
<span class="lineNum">    1218 </span>                :<span class="lineCov">       3724 :             | (tm0-&gt;tm_mday ^ tm1-&gt;tm_mday)</span>
<span class="lineNum">    1219 </span>                :<span class="lineCov">       3724 :             | (tm0-&gt;tm_mon ^ tm1-&gt;tm_mon)</span>
<span class="lineNum">    1220 </span>                :<span class="lineCov">       3724 :             | (tm0-&gt;tm_year ^ tm1-&gt;tm_year));</span>
<span class="lineNum">    1221 </span>                :            : }
<span class="lineNum">    1222 </span>                :            : 
<span class="lineNum">    1223 </span>                :            : /* A reasonable upper bound for the size of ordinary TZ strings.
<span class="lineNum">    1224 </span>                :            :    Use heap allocation if TZ's length exceeds this.  */
<span class="lineNum">    1225 </span>                :            : enum { TZBUFSIZE = 100 };
<span class="lineNum">    1226 </span>                :            : 
<span class="lineNum">    1227 </span>                :            : /* Return a copy of TZ, stored in TZBUF if it fits, and heap-allocated
<a name="1228"><span class="lineNum">    1228 </span>                :            :    otherwise.  */</a>
<span class="lineNum">    1229 </span>                :            : static char *
<span class="lineNum">    1230 </span>                :<span class="lineNoCov">          0 : get_tz (char tzbuf[TZBUFSIZE])</span>
<span class="lineNum">    1231 </span>                :            : {
<span class="lineNum">    1232 </span>                :<span class="lineNoCov">          0 :   char *tz = getenv (&quot;TZ&quot;);</span>
<span class="lineNum">    1233 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :   if (tz)</span>
<span class="lineNum">    1234 </span>                :            :     {
<span class="lineNum">    1235 </span>                :<span class="lineNoCov">          0 :       size_t tzsize = strlen (tz) + 1;</span>
<span class="lineNum">    1236 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :       tz = (tzsize &lt;= TZBUFSIZE</span>
<span class="lineNum">    1237 </span>                :<span class="lineNoCov">          0 :             ? memcpy (tzbuf, tz, tzsize)</span>
<span class="lineNum">    1238 </span>                :            :             : xmemdup (tz, tzsize));
<span class="lineNum">    1239 </span>                :            :     }
<span class="lineNum">    1240 </span>                :<span class="lineNoCov">          0 :   return tz;</span>
<span class="lineNum">    1241 </span>                :            : }
<span class="lineNum">    1242 </span>                :            : 
<span class="lineNum">    1243 </span>                :            : /* Parse a date/time string, storing the resulting time value into *RESULT.
<span class="lineNum">    1244 </span>                :            :    The string itself is pointed to by P.  Return true if successful.
<span class="lineNum">    1245 </span>                :            :    P can be an incomplete or relative time specification; if so, use
<a name="1246"><span class="lineNum">    1246 </span>                :            :    *NOW as the basis for the returned time.  */</a>
<span class="lineNum">    1247 </span>                :            : bool
<span class="lineNum">    1248 </span>                :<span class="lineCov">       3822 : parse_datetime (struct timespec *result, char const *p,</span>
<span class="lineNum">    1249 </span>                :            :                 struct timespec const *now)
<span class="lineNum">    1250 </span>                :            : {
<span class="lineNum">    1251 </span>                :            :   time_t Start;
<span class="lineNum">    1252 </span>                :            :   long int Start_ns;
<span class="lineNum">    1253 </span>                :            :   struct tm const *tmp;
<span class="lineNum">    1254 </span>                :            :   struct tm tm;
<span class="lineNum">    1255 </span>                :            :   struct tm tm0;
<span class="lineNum">    1256 </span>                :            :   parser_control pc;
<span class="lineNum">    1257 </span>                :            :   struct timespec gettime_buffer;
<span class="lineNum">    1258 </span>                :            :   unsigned char c;
<span class="lineNum">    1259 </span>                :<span class="lineCov">       3822 :   bool tz_was_altered = false;</span>
<span class="lineNum">    1260 </span>                :<span class="lineCov">       3822 :   char *tz0 = NULL;</span>
<span class="lineNum">    1261 </span>                :            :   char tz0buf[TZBUFSIZE];
<span class="lineNum">    1262 </span>                :<span class="lineCov">       3822 :   bool ok = true;</span>
<span class="lineNum">    1263 </span>                :            : 
<span class="lineNum">    1264 </span>        [<span class="branchCov" title="Branch 0 was taken 3213 times"> + </span><span class="branchCov" title="Branch 1 was taken 609 times"> + </span>]:<span class="lineCov">       3822 :   if (! now)</span>
<span class="lineNum">    1265 </span>                :            :     {
<span class="lineNum">    1266 </span>                :<span class="lineCov">       3213 :       gettime (&amp;gettime_buffer);</span>
<span class="lineNum">    1267 </span>                :<span class="lineCov">       3213 :       now = &amp;gettime_buffer;</span>
<span class="lineNum">    1268 </span>                :            :     }
<span class="lineNum">    1269 </span>                :            : 
<span class="lineNum">    1270 </span>                :<span class="lineCov">       3822 :   Start = now-&gt;tv_sec;</span>
<span class="lineNum">    1271 </span>                :<span class="lineCov">       3822 :   Start_ns = now-&gt;tv_nsec;</span>
<span class="lineNum">    1272 </span>                :            : 
<span class="lineNum">    1273 </span>                :<span class="lineCov">       3822 :   tmp = localtime (&amp;now-&gt;tv_sec);</span>
<span class="lineNum">    1274 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 3822 times"> + </span>]:<span class="lineCov">       3822 :   if (! tmp)</span>
<span class="lineNum">    1275 </span>                :<span class="lineNoCov">          0 :     return false;</span>
<span class="lineNum">    1276 </span>                :            : 
<span class="lineNum">    1277 </span>        [<span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 3822 times"> + </span>]:<span class="lineCov">       3822 :   while (c = *p, c_isspace (c))</span>
<span class="lineNum">    1278 </span>                :<span class="lineNoCov">          0 :     p++;</span>
<span class="lineNum">    1279 </span>                :            : 
<span class="lineNum">    1280 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 3822 times"> + </span>]:<span class="lineCov">       3822 :   if (strncmp (p, &quot;TZ=\&quot;&quot;, 4) == 0)</span>
<span class="lineNum">    1281 </span>                :            :     {
<span class="lineNum">    1282 </span>                :<span class="lineNoCov">          0 :       char const *tzbase = p + 4;</span>
<span class="lineNum">    1283 </span>                :<span class="lineNoCov">          0 :       size_t tzsize = 1;</span>
<span class="lineNum">    1284 </span>                :            :       char const *s;
<span class="lineNum">    1285 </span>                :            : 
<span class="lineNum">    1286 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :       for (s = tzbase; *s; s++, tzsize++)</span>
<span class="lineNum">    1287 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (*s == '\\')</span>
<span class="lineNum">    1288 </span>                :            :           {
<span class="lineNum">    1289 </span>                :<span class="lineNoCov">          0 :             s++;</span>
<span class="lineNum">    1290 </span>[<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>][<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :             if (! (*s == '\\' || *s == '&quot;'))</span>
<span class="lineNum">    1291 </span>                :<span class="lineNoCov">          0 :               break;</span>
<span class="lineNum">    1292 </span>                :            :           }
<span class="lineNum">    1293 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         else if (*s == '&quot;')</span>
<span class="lineNum">    1294 </span>                :            :           {
<span class="lineNum">    1295 </span>                :            :             char *z;
<span class="lineNum">    1296 </span>                :            :             char *tz1;
<span class="lineNum">    1297 </span>                :            :             char tz1buf[TZBUFSIZE];
<span class="lineNum">    1298 </span>                :<span class="lineNoCov">          0 :             bool large_tz = TZBUFSIZE &lt; tzsize;</span>
<span class="lineNum">    1299 </span>                :            :             bool setenv_ok;
<span class="lineNum">    1300 </span>                :            :             /* Free tz0, in case this is the 2nd or subsequent time through. */
<span class="lineNum">    1301 </span>                :<span class="lineNoCov">          0 :             free (tz0);</span>
<span class="lineNum">    1302 </span>                :<span class="lineNoCov">          0 :             tz0 = get_tz (tz0buf);</span>
<span class="lineNum">    1303 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :             z = tz1 = large_tz ? xmalloc (tzsize) : tz1buf;</span>
<span class="lineNum">    1304 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :             for (s = tzbase; *s != '&quot;'; s++)</span>
<span class="lineNum">    1305 </span>                :<span class="lineNoCov">          0 :               *z++ = *(s += *s == '\\');</span>
<span class="lineNum">    1306 </span>                :<span class="lineNoCov">          0 :             *z = '\0';</span>
<span class="lineNum">    1307 </span>                :<span class="lineNoCov">          0 :             setenv_ok = setenv (&quot;TZ&quot;, tz1, 1) == 0;</span>
<span class="lineNum">    1308 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :             if (large_tz)</span>
<span class="lineNum">    1309 </span>                :<span class="lineNoCov">          0 :               free (tz1);</span>
<span class="lineNum">    1310 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :             if (!setenv_ok)</span>
<span class="lineNum">    1311 </span>                :<span class="lineNoCov">          0 :               goto fail;</span>
<span class="lineNum">    1312 </span>                :<span class="lineNoCov">          0 :             tz_was_altered = true;</span>
<span class="lineNum">    1313 </span>                :<span class="lineNoCov">          0 :             p = s + 1;</span>
<span class="lineNum">    1314 </span>                :            :           }
<span class="lineNum">    1315 </span>                :            :     }
<span class="lineNum">    1316 </span>                :            : 
<span class="lineNum">    1317 </span>                :            :   /* As documented, be careful to treat the empty string just like
<span class="lineNum">    1318 </span>                :            :      a date string of &quot;0&quot;.  Without this, an empty string would be
<span class="lineNum">    1319 </span>                :            :      declared invalid when parsed during a DST transition.  */
<span class="lineNum">    1320 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 3822 times"> + </span>]:<span class="lineCov">       3822 :   if (*p == '\0')</span>
<span class="lineNum">    1321 </span>                :<span class="lineNoCov">          0 :     p = &quot;0&quot;;</span>
<span class="lineNum">    1322 </span>                :            : 
<span class="lineNum">    1323 </span>                :<span class="lineCov">       3822 :   pc.input = p;</span>
<span class="lineNum">    1324 </span>                :<span class="lineCov">       3822 :   pc.year.value = tmp-&gt;tm_year;</span>
<span class="lineNum">    1325 </span>                :<span class="lineCov">       3822 :   pc.year.value += TM_YEAR_BASE;</span>
<span class="lineNum">    1326 </span>                :<span class="lineCov">       3822 :   pc.year.digits = 0;</span>
<span class="lineNum">    1327 </span>                :<span class="lineCov">       3822 :   pc.month = tmp-&gt;tm_mon + 1;</span>
<span class="lineNum">    1328 </span>                :<span class="lineCov">       3822 :   pc.day = tmp-&gt;tm_mday;</span>
<span class="lineNum">    1329 </span>                :<span class="lineCov">       3822 :   pc.hour = tmp-&gt;tm_hour;</span>
<span class="lineNum">    1330 </span>                :<span class="lineCov">       3822 :   pc.minutes = tmp-&gt;tm_min;</span>
<span class="lineNum">    1331 </span>                :<span class="lineCov">       3822 :   pc.seconds.tv_sec = tmp-&gt;tm_sec;</span>
<span class="lineNum">    1332 </span>                :<span class="lineCov">       3822 :   pc.seconds.tv_nsec = Start_ns;</span>
<span class="lineNum">    1333 </span>                :<span class="lineCov">       3822 :   tm.tm_isdst = tmp-&gt;tm_isdst;</span>
<span class="lineNum">    1334 </span>                :            : 
<span class="lineNum">    1335 </span>                :<span class="lineCov">       3822 :   pc.meridian = MER24;</span>
<span class="lineNum">    1336 </span>                :<span class="lineCov">       3822 :   pc.rel = RELATIVE_TIME_0;</span>
<span class="lineNum">    1337 </span>                :<span class="lineCov">       3822 :   pc.timespec_seen = false;</span>
<span class="lineNum">    1338 </span>                :<span class="lineCov">       3822 :   pc.rels_seen = false;</span>
<span class="lineNum">    1339 </span>                :<span class="lineCov">       3822 :   pc.dates_seen = 0;</span>
<span class="lineNum">    1340 </span>                :<span class="lineCov">       3822 :   pc.days_seen = 0;</span>
<span class="lineNum">    1341 </span>                :<span class="lineCov">       3822 :   pc.times_seen = 0;</span>
<span class="lineNum">    1342 </span>                :<span class="lineCov">       3822 :   pc.local_zones_seen = 0;</span>
<span class="lineNum">    1343 </span>                :<span class="lineCov">       3822 :   pc.dsts_seen = 0;</span>
<span class="lineNum">    1344 </span>                :<span class="lineCov">       3822 :   pc.zones_seen = 0;</span>
<span class="lineNum">    1345 </span>                :            : 
<span class="lineNum">    1346 </span>                :            : #if HAVE_STRUCT_TM_TM_ZONE
<span class="lineNum">    1347 </span>                :<span class="lineCov">       3822 :   pc.local_time_zone_table[0].name = tmp-&gt;tm_zone;</span>
<span class="lineNum">    1348 </span>                :<span class="lineCov">       3822 :   pc.local_time_zone_table[0].type = tLOCAL_ZONE;</span>
<span class="lineNum">    1349 </span>                :<span class="lineCov">       3822 :   pc.local_time_zone_table[0].value = tmp-&gt;tm_isdst;</span>
<span class="lineNum">    1350 </span>                :<span class="lineCov">       3822 :   pc.local_time_zone_table[1].name = NULL;</span>
<span class="lineNum">    1351 </span>                :            : 
<span class="lineNum">    1352 </span>                :            :   /* Probe the names used in the next three calendar quarters, looking
<span class="lineNum">    1353 </span>                :            :      for a tm_isdst different from the one we already have.  */
<span class="lineNum">    1354 </span>                :            :   {
<span class="lineNum">    1355 </span>                :            :     int quarter;
<span class="lineNum">    1356 </span>        [<span class="branchCov" title="Branch 0 was taken 5796 times"> + </span><span class="branchCov" title="Branch 1 was taken 987 times"> + </span>]:<span class="lineCov">       6783 :     for (quarter = 1; quarter &lt;= 3; quarter++)</span>
<span class="lineNum">    1357 </span>                :            :       {
<span class="lineNum">    1358 </span>                :<span class="lineCov">       5796 :         time_t probe = Start + quarter * (90 * 24 * 60 * 60);</span>
<span class="lineNum">    1359 </span>                :<span class="lineCov">       5796 :         struct tm const *probe_tm = localtime (&amp;probe);</span>
<span class="lineNum">    1360 </span>[<span class="branchCov" title="Branch 2 was taken 5796 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>][<span class="branchCov" title="Branch 0 was taken 5796 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       5796 :         if (probe_tm &amp;&amp; probe_tm-&gt;tm_zone</span>
<span class="lineNum">    1361 </span>        [<span class="branchCov" title="Branch 0 was taken 2835 times"> + </span><span class="branchCov" title="Branch 1 was taken 2961 times"> + </span>]:<span class="lineCov">       5796 :             &amp;&amp; probe_tm-&gt;tm_isdst != pc.local_time_zone_table[0].value)</span>
<span class="lineNum">    1362 </span>                :            :           {
<span class="lineNum">    1363 </span>                :            :               {
<span class="lineNum">    1364 </span>                :<span class="lineCov">       2835 :                 pc.local_time_zone_table[1].name = probe_tm-&gt;tm_zone;</span>
<span class="lineNum">    1365 </span>                :<span class="lineCov">       2835 :                 pc.local_time_zone_table[1].type = tLOCAL_ZONE;</span>
<span class="lineNum">    1366 </span>                :<span class="lineCov">       2835 :                 pc.local_time_zone_table[1].value = probe_tm-&gt;tm_isdst;</span>
<span class="lineNum">    1367 </span>                :<span class="lineCov">       2835 :                 pc.local_time_zone_table[2].name = NULL;</span>
<span class="lineNum">    1368 </span>                :            :               }
<span class="lineNum">    1369 </span>                :<span class="lineCov">       2835 :             break;</span>
<span class="lineNum">    1370 </span>                :            :           }
<span class="lineNum">    1371 </span>                :            :       }
<span class="lineNum">    1372 </span>                :            :   }
<span class="lineNum">    1373 </span>                :            : #else
<span class="lineNum">    1374 </span>                :            : #if HAVE_TZNAME
<span class="lineNum">    1375 </span>                :            :   {
<span class="lineNum">    1376 </span>                :            : # if !HAVE_DECL_TZNAME
<span class="lineNum">    1377 </span>                :            :     extern char *tzname[];
<span class="lineNum">    1378 </span>                :            : # endif
<span class="lineNum">    1379 </span>                :            :     int i;
<span class="lineNum">    1380 </span>                :            :     for (i = 0; i &lt; 2; i++)
<span class="lineNum">    1381 </span>                :            :       {
<span class="lineNum">    1382 </span>                :            :         pc.local_time_zone_table[i].name = tzname[i];
<span class="lineNum">    1383 </span>                :            :         pc.local_time_zone_table[i].type = tLOCAL_ZONE;
<span class="lineNum">    1384 </span>                :            :         pc.local_time_zone_table[i].value = i;
<span class="lineNum">    1385 </span>                :            :       }
<span class="lineNum">    1386 </span>                :            :     pc.local_time_zone_table[i].name = NULL;
<span class="lineNum">    1387 </span>                :            :   }
<span class="lineNum">    1388 </span>                :            : #else
<span class="lineNum">    1389 </span>                :            :   pc.local_time_zone_table[0].name = NULL;
<span class="lineNum">    1390 </span>                :            : #endif
<span class="lineNum">    1391 </span>                :            : #endif
<span class="lineNum">    1392 </span>                :            : 
<span class="lineNum">    1393 </span>[<span class="branchCov" title="Branch 0 was taken 3822 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 2835 times"> + </span><span class="branchCov" title="Branch 3 was taken 987 times"> + </span>]:<span class="lineCov">       3822 :   if (pc.local_time_zone_table[0].name &amp;&amp; pc.local_time_zone_table[1].name</span>
<span class="lineNum">    1394 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 2835 times"> + </span>]:<span class="lineCov">       2835 :       &amp;&amp; ! strcmp (pc.local_time_zone_table[0].name,</span>
<span class="lineNum">    1395 </span>                :            :                    pc.local_time_zone_table[1].name))
<span class="lineNum">    1396 </span>                :            :     {
<span class="lineNum">    1397 </span>                :            :       /* This locale uses the same abbreviation for standard and
<span class="lineNum">    1398 </span>                :            :          daylight times.  So if we see that abbreviation, we don't
<span class="lineNum">    1399 </span>                :            :          know whether it's daylight time.  */
<span class="lineNum">    1400 </span>                :<span class="lineNoCov">          0 :       pc.local_time_zone_table[0].value = -1;</span>
<span class="lineNum">    1401 </span>                :<span class="lineNoCov">          0 :       pc.local_time_zone_table[1].name = NULL;</span>
<span class="lineNum">    1402 </span>                :            :     }
<span class="lineNum">    1403 </span>                :            : 
<span class="lineNum">    1404 </span>        [<span class="branchCov" title="Branch 1 was taken 49 times"> + </span><span class="branchCov" title="Branch 2 was taken 3773 times"> + </span>]:<span class="lineCov">       3822 :   if (yyparse (&amp;pc) != 0)</span>
<span class="lineNum">    1405 </span>                :<span class="lineCov">         49 :     goto fail;</span>
<span class="lineNum">    1406 </span>                :            : 
<span class="lineNum">    1407 </span>        [<span class="branchCov" title="Branch 0 was taken 42 times"> + </span><span class="branchCov" title="Branch 1 was taken 3731 times"> + </span>]:<span class="lineCov">       3773 :   if (pc.timespec_seen)</span>
<span class="lineNum">    1408 </span>                :<span class="lineCov">         42 :     *result = pc.seconds;</span>
<span class="lineNum">    1409 </span>                :            :   else
<span class="lineNum">    1410 </span>                :            :     {
<span class="lineNum">    1411 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchCov" title="Branch 1 was taken 3724 times"> + </span>]:<span class="lineCov">       3731 :       if (1 &lt; (pc.times_seen | pc.dates_seen | pc.days_seen | pc.dsts_seen</span>
<span class="lineNum">    1412 </span>                :<span class="lineCov">       3731 :                | (pc.local_zones_seen + pc.zones_seen)))</span>
<span class="lineNum">    1413 </span>                :<span class="lineCov">          7 :         goto fail;</span>
<span class="lineNum">    1414 </span>                :            : 
<span class="lineNum">    1415 </span>                :<span class="lineCov">       3724 :       tm.tm_year = to_year (pc.year) - TM_YEAR_BASE;</span>
<span class="lineNum">    1416 </span>                :<span class="lineCov">       3724 :       tm.tm_mon = pc.month - 1;</span>
<span class="lineNum">    1417 </span>                :<span class="lineCov">       3724 :       tm.tm_mday = pc.day;</span>
<span class="lineNum">    1418 </span>[<span class="branchCov" title="Branch 2 was taken 2835 times"> + </span><span class="branchCov" title="Branch 3 was taken 385 times"> + </span>][<span class="branchCov" title="Branch 4 was taken 231 times"> + </span><span class="branchCov" title="Branch 5 was taken 2604 times"> + </span>]:<span class="lineCov">       3724 :       if (pc.times_seen || (pc.rels_seen &amp;&amp; ! pc.dates_seen &amp;&amp; ! pc.days_seen))</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 6 was taken 231 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>][<span class="branchCov" title="Branch 0 was taken 3220 times"> + </span><span class="branchCov" title="Branch 1 was taken 504 times"> + </span>]
<span class="lineNum">    1419 </span>                :            :         {
<span class="lineNum">    1420 </span>                :<span class="lineCov">        735 :           tm.tm_hour = to_hour (pc.hour, pc.meridian);</span>
<span class="lineNum">    1421 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 735 times"> + </span>]:<span class="lineCov">        735 :           if (tm.tm_hour &lt; 0)</span>
<span class="lineNum">    1422 </span>                :<span class="lineNoCov">          0 :             goto fail;</span>
<span class="lineNum">    1423 </span>                :<span class="lineCov">        735 :           tm.tm_min = pc.minutes;</span>
<span class="lineNum">    1424 </span>                :<span class="lineCov">        735 :           tm.tm_sec = pc.seconds.tv_sec;</span>
<span class="lineNum">    1425 </span>                :            :         }
<span class="lineNum">    1426 </span>                :            :       else
<span class="lineNum">    1427 </span>                :            :         {
<span class="lineNum">    1428 </span>                :<span class="lineCov">       2989 :           tm.tm_hour = tm.tm_min = tm.tm_sec = 0;</span>
<span class="lineNum">    1429 </span>                :<span class="lineCov">       2989 :           pc.seconds.tv_nsec = 0;</span>
<span class="lineNum">    1430 </span>                :            :         }
<span class="lineNum">    1431 </span>                :            : 
<span class="lineNum">    1432 </span>                :            :       /* Let mktime deduce tm_isdst if we have an absolute time stamp.  */
<span class="lineNum">    1433 </span>        [<span class="branchCov" title="Branch 0 was taken 3423 times"> + </span><span class="branchCov" title="Branch 1 was taken 301 times"> + </span>]:<span class="lineCov">       3724 :       if (pc.dates_seen | pc.days_seen | pc.times_seen)</span>
<span class="lineNum">    1434 </span>                :<span class="lineCov">       3423 :         tm.tm_isdst = -1;</span>
<span class="lineNum">    1435 </span>                :            : 
<span class="lineNum">    1436 </span>                :            :       /* But if the input explicitly specifies local time with or without
<span class="lineNum">    1437 </span>                :            :          DST, give mktime that information.  */
<span class="lineNum">    1438 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 3724 times"> + </span>]:<span class="lineCov">       3724 :       if (pc.local_zones_seen)</span>
<span class="lineNum">    1439 </span>                :<span class="lineNoCov">          0 :         tm.tm_isdst = pc.local_isdst;</span>
<span class="lineNum">    1440 </span>                :            : 
<span class="lineNum">    1441 </span>                :<span class="lineCov">       3724 :       tm0 = tm;</span>
<span class="lineNum">    1442 </span>                :            : 
<span class="lineNum">    1443 </span>                :<span class="lineCov">       3724 :       Start = mktime (&amp;tm);</span>
<span class="lineNum">    1444 </span>                :            : 
<span class="lineNum">    1445 </span>        [<span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 3724 times"> + </span>]:<span class="lineCov">       3724 :       if (! mktime_ok (&amp;tm0, &amp;tm, Start))</span>
<span class="lineNum">    1446 </span>                :            :         {
<span class="lineNum">    1447 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :           if (! pc.zones_seen)</span>
<span class="lineNum">    1448 </span>                :<span class="lineNoCov">          0 :             goto fail;</span>
<span class="lineNum">    1449 </span>                :            :           else
<span class="lineNum">    1450 </span>                :            :             {
<span class="lineNum">    1451 </span>                :            :               /* Guard against falsely reporting errors near the time_t
<span class="lineNum">    1452 </span>                :            :                  boundaries when parsing times in other time zones.  For
<span class="lineNum">    1453 </span>                :            :                  example, suppose the input string &quot;1969-12-31 23:00:00 -0100&quot;,
<span class="lineNum">    1454 </span>                :            :                  the current time zone is 8 hours ahead of UTC, and the min
<span class="lineNum">    1455 </span>                :            :                  time_t value is 1970-01-01 00:00:00 UTC.  Then the min
<span class="lineNum">    1456 </span>                :            :                  localtime value is 1970-01-01 08:00:00, and mktime will
<span class="lineNum">    1457 </span>                :            :                  therefore fail on 1969-12-31 23:00:00.  To work around the
<span class="lineNum">    1458 </span>                :            :                  problem, set the time zone to 1 hour behind UTC temporarily
<span class="lineNum">    1459 </span>                :            :                  by setting TZ=&quot;XXX1:00&quot; and try mktime again.  */
<span class="lineNum">    1460 </span>                :            : 
<span class="lineNum">    1461 </span>                :<span class="lineNoCov">          0 :               long int time_zone = pc.time_zone;</span>
<span class="lineNum">    1462 </span>                :<span class="lineNoCov">          0 :               long int abs_time_zone = time_zone &lt; 0 ? - time_zone : time_zone;</span>
<span class="lineNum">    1463 </span>                :<span class="lineNoCov">          0 :               long int abs_time_zone_hour = abs_time_zone / 60;</span>
<span class="lineNum">    1464 </span>                :<span class="lineNoCov">          0 :               int abs_time_zone_min = abs_time_zone % 60;</span>
<span class="lineNum">    1465 </span>                :            :               char tz1buf[sizeof &quot;XXX+0:00&quot;
<span class="lineNum">    1466 </span>                :            :                           + sizeof pc.time_zone * CHAR_BIT / 3];
<span class="lineNum">    1467 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :               if (!tz_was_altered)</span>
<span class="lineNum">    1468 </span>                :<span class="lineNoCov">          0 :                 tz0 = get_tz (tz0buf);</span>
<span class="lineNum">    1469 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :               sprintf (tz1buf, &quot;XXX%s%ld:%02d&quot;, &quot;-&quot; + (time_zone &lt; 0),</span>
<span class="lineNum">    1470 </span>                :            :                        abs_time_zone_hour, abs_time_zone_min);
<span class="lineNum">    1471 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :               if (setenv (&quot;TZ&quot;, tz1buf, 1) != 0)</span>
<span class="lineNum">    1472 </span>                :<span class="lineNoCov">          0 :                 goto fail;</span>
<span class="lineNum">    1473 </span>                :<span class="lineNoCov">          0 :               tz_was_altered = true;</span>
<span class="lineNum">    1474 </span>                :<span class="lineNoCov">          0 :               tm = tm0;</span>
<span class="lineNum">    1475 </span>                :<span class="lineNoCov">          0 :               Start = mktime (&amp;tm);</span>
<span class="lineNum">    1476 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :               if (! mktime_ok (&amp;tm0, &amp;tm, Start))</span>
<span class="lineNum">    1477 </span>                :<span class="lineNoCov">          0 :                 goto fail;</span>
<span class="lineNum">    1478 </span>                :            :             }
<span class="lineNum">    1479 </span>                :            :         }
<span class="lineNum">    1480 </span>                :            : 
<span class="lineNum">    1481 </span>[<span class="branchCov" title="Branch 0 was taken 133 times"> + </span><span class="branchCov" title="Branch 1 was taken 3591 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 133 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       3724 :       if (pc.days_seen &amp;&amp; ! pc.dates_seen)</span>
<span class="lineNum">    1482 </span>                :            :         {
<span class="lineNum">    1483 </span>                :<span class="lineCov">        266 :           tm.tm_mday += ((pc.day_number - tm.tm_wday + 7) % 7</span>
<span class="lineNum">    1484 </span>                :<span class="lineCov">        133 :                          + 7 * (pc.day_ordinal</span>
<span class="lineNum">    1485 </span>        [<span class="branchCov" title="Branch 0 was taken 56 times"> + </span><span class="branchCov" title="Branch 1 was taken 77 times"> + </span>]:<span class="lineCov">        189 :                                 - (0 &lt; pc.day_ordinal</span>
<span class="lineNum">    1486 </span>        [<span class="branchCov" title="Branch 0 was taken 42 times"> + </span><span class="branchCov" title="Branch 1 was taken 14 times"> + </span>]:<span class="lineCov">         56 :                                    &amp;&amp; tm.tm_wday != pc.day_number)));</span>
<span class="lineNum">    1487 </span>                :<span class="lineCov">        133 :           tm.tm_isdst = -1;</span>
<span class="lineNum">    1488 </span>                :<span class="lineCov">        133 :           Start = mktime (&amp;tm);</span>
<span class="lineNum">    1489 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 133 times"> + </span>]:<span class="lineCov">        133 :           if (Start == (time_t) -1)</span>
<span class="lineNum">    1490 </span>                :<span class="lineNoCov">          0 :             goto fail;</span>
<span class="lineNum">    1491 </span>                :            :         }
<span class="lineNum">    1492 </span>                :            : 
<span class="lineNum">    1493 </span>                :            :       /* Add relative date.  */
<span class="lineNum">    1494 </span>        [<span class="branchCov" title="Branch 0 was taken 2828 times"> + </span><span class="branchCov" title="Branch 1 was taken 896 times"> + </span>]:<span class="lineCov">       3724 :       if (pc.rel.year | pc.rel.month | pc.rel.day)</span>
<span class="lineNum">    1495 </span>                :            :         {
<span class="lineNum">    1496 </span>                :<span class="lineCov">       2828 :           int year = tm.tm_year + pc.rel.year;</span>
<span class="lineNum">    1497 </span>                :<span class="lineCov">       2828 :           int month = tm.tm_mon + pc.rel.month;</span>
<span class="lineNum">    1498 </span>                :<span class="lineCov">       2828 :           int day = tm.tm_mday + pc.rel.day;</span>
<span class="lineNum">    1499 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 2828 times"> + </span>]:<span class="lineCov">       2828 :           if (((year &lt; tm.tm_year) ^ (pc.rel.year &lt; 0))</span>
<span class="lineNum">    1500 </span>                :<span class="lineCov">       2828 :               | ((month &lt; tm.tm_mon) ^ (pc.rel.month &lt; 0))</span>
<span class="lineNum">    1501 </span>                :<span class="lineCov">       2828 :               | ((day &lt; tm.tm_mday) ^ (pc.rel.day &lt; 0)))</span>
<span class="lineNum">    1502 </span>                :<span class="lineNoCov">          0 :             goto fail;</span>
<span class="lineNum">    1503 </span>                :<span class="lineCov">       2828 :           tm.tm_year = year;</span>
<span class="lineNum">    1504 </span>                :<span class="lineCov">       2828 :           tm.tm_mon = month;</span>
<span class="lineNum">    1505 </span>                :<span class="lineCov">       2828 :           tm.tm_mday = day;</span>
<span class="lineNum">    1506 </span>                :<span class="lineCov">       2828 :           tm.tm_hour = tm0.tm_hour;</span>
<span class="lineNum">    1507 </span>                :<span class="lineCov">       2828 :           tm.tm_min = tm0.tm_min;</span>
<span class="lineNum">    1508 </span>                :<span class="lineCov">       2828 :           tm.tm_sec = tm0.tm_sec;</span>
<span class="lineNum">    1509 </span>                :<span class="lineCov">       2828 :           tm.tm_isdst = tm0.tm_isdst;</span>
<span class="lineNum">    1510 </span>                :<span class="lineCov">       2828 :           Start = mktime (&amp;tm);</span>
<span class="lineNum">    1511 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 2828 times"> + </span>]:<span class="lineCov">       2828 :           if (Start == (time_t) -1)</span>
<span class="lineNum">    1512 </span>                :<span class="lineNoCov">          0 :             goto fail;</span>
<span class="lineNum">    1513 </span>                :            :         }
<span class="lineNum">    1514 </span>                :            : 
<span class="lineNum">    1515 </span>                :            :       /* The only &quot;output&quot; of this if-block is an updated Start value,
<span class="lineNum">    1516 </span>                :            :          so this block must follow others that clobber Start.  */
<span class="lineNum">    1517 </span>        [<span class="branchCov" title="Branch 0 was taken 483 times"> + </span><span class="branchCov" title="Branch 1 was taken 3241 times"> + </span>]:<span class="lineCov">       3724 :       if (pc.zones_seen)</span>
<span class="lineNum">    1518 </span>                :            :         {
<span class="lineNum">    1519 </span>                :<span class="lineCov">        483 :           long int delta = pc.time_zone * 60;</span>
<span class="lineNum">    1520 </span>                :            :           time_t t1;
<span class="lineNum">    1521 </span>                :            : #ifdef HAVE_TM_GMTOFF
<span class="lineNum">    1522 </span>                :<span class="lineCov">        483 :           delta -= tm.tm_gmtoff;</span>
<span class="lineNum">    1523 </span>                :            : #else
<span class="lineNum">    1524 </span>                :            :           time_t t = Start;
<span class="lineNum">    1525 </span>                :            :           struct tm const *gmt = gmtime (&amp;t);
<span class="lineNum">    1526 </span>                :            :           if (! gmt)
<span class="lineNum">    1527 </span>                :            :             goto fail;
<span class="lineNum">    1528 </span>                :            :           delta -= tm_diff (&amp;tm, gmt);
<span class="lineNum">    1529 </span>                :            : #endif
<span class="lineNum">    1530 </span>                :<span class="lineCov">        483 :           t1 = Start - delta;</span>
<span class="lineNum">    1531 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 483 times"> + </span>]:<span class="lineCov">        483 :           if ((Start &lt; t1) != (delta &lt; 0))</span>
<span class="lineNum">    1532 </span>                :<span class="lineNoCov">          0 :             goto fail;  /* time_t overflow */</span>
<span class="lineNum">    1533 </span>                :<span class="lineCov">        483 :           Start = t1;</span>
<span class="lineNum">    1534 </span>                :            :         }
<span class="lineNum">    1535 </span>                :            : 
<span class="lineNum">    1536 </span>                :            :       /* Add relative hours, minutes, and seconds.  On hosts that support
<span class="lineNum">    1537 </span>                :            :          leap seconds, ignore the possibility of leap seconds; e.g.,
<span class="lineNum">    1538 </span>                :            :          &quot;+ 10 minutes&quot; adds 600 seconds, even if one of them is a
<span class="lineNum">    1539 </span>                :            :          leap second.  Typically this is not what the user wants, but it's
<span class="lineNum">    1540 </span>                :            :          too hard to do it the other way, because the time zone indicator
<span class="lineNum">    1541 </span>                :            :          must be applied before relative times, and if mktime is applied
<span class="lineNum">    1542 </span>                :            :          again the time zone will be lost.  */
<span class="lineNum">    1543 </span>                :            :       {
<span class="lineNum">    1544 </span>                :<span class="lineCov">       3724 :         long int sum_ns = pc.seconds.tv_nsec + pc.rel.ns;</span>
<span class="lineNum">    1545 </span>                :<span class="lineCov">       3724 :         long int normalized_ns = (sum_ns % BILLION + BILLION) % BILLION;</span>
<span class="lineNum">    1546 </span>                :<span class="lineCov">       3724 :         time_t t0 = Start;</span>
<span class="lineNum">    1547 </span>                :<span class="lineCov">       3724 :         long int d1 = 60 * 60 * pc.rel.hour;</span>
<span class="lineNum">    1548 </span>                :<span class="lineCov">       3724 :         time_t t1 = t0 + d1;</span>
<span class="lineNum">    1549 </span>                :<span class="lineCov">       3724 :         long int d2 = 60 * pc.rel.minutes;</span>
<span class="lineNum">    1550 </span>                :<span class="lineCov">       3724 :         time_t t2 = t1 + d2;</span>
<span class="lineNum">    1551 </span>                :<span class="lineCov">       3724 :         long_time_t d3 = pc.rel.seconds;</span>
<span class="lineNum">    1552 </span>                :<span class="lineCov">       3724 :         long_time_t t3 = t2 + d3;</span>
<span class="lineNum">    1553 </span>                :<span class="lineCov">       3724 :         long int d4 = (sum_ns - normalized_ns) / BILLION;</span>
<span class="lineNum">    1554 </span>                :<span class="lineCov">       3724 :         long_time_t t4 = t3 + d4;</span>
<span class="lineNum">    1555 </span>                :<span class="lineCov">       3724 :         time_t t5 = t4;</span>
<span class="lineNum">    1556 </span>                :            : 
<span class="lineNum">    1557 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 3724 times"> + </span>]:<span class="lineCov">       3724 :         if ((d1 / (60 * 60) ^ pc.rel.hour)</span>
<span class="lineNum">    1558 </span>                :<span class="lineCov">       3724 :             | (d2 / 60 ^ pc.rel.minutes)</span>
<span class="lineNum">    1559 </span>                :<span class="lineCov">       3724 :             | ((t1 &lt; t0) ^ (d1 &lt; 0))</span>
<span class="lineNum">    1560 </span>                :<span class="lineCov">       3724 :             | ((t2 &lt; t1) ^ (d2 &lt; 0))</span>
<span class="lineNum">    1561 </span>                :<span class="lineCov">       3724 :             | ((t3 &lt; t2) ^ (d3 &lt; 0))</span>
<span class="lineNum">    1562 </span>                :<span class="lineCov">       3724 :             | ((t4 &lt; t3) ^ (d4 &lt; 0))</span>
<span class="lineNum">    1563 </span>                :<span class="lineCov">       3724 :             | (t5 != t4))</span>
<span class="lineNum">    1564 </span>                :<span class="lineNoCov">          0 :           goto fail;</span>
<span class="lineNum">    1565 </span>                :            : 
<span class="lineNum">    1566 </span>                :<span class="lineCov">       3724 :         result-&gt;tv_sec = t5;</span>
<span class="lineNum">    1567 </span>                :<span class="lineCov">       3724 :         result-&gt;tv_nsec = normalized_ns;</span>
<span class="lineNum">    1568 </span>                :            :       }
<span class="lineNum">    1569 </span>                :            :     }
<span class="lineNum">    1570 </span>                :            : 
<span class="lineNum">    1571 </span>                :<span class="lineCov">       3766 :   goto done;</span>
<span class="lineNum">    1572 </span>                :            : 
<span class="lineNum">    1573 </span>                :            :  fail:
<span class="lineNum">    1574 </span>                :<span class="lineCov">         56 :   ok = false;</span>
<span class="lineNum">    1575 </span>                :            :  done:
<span class="lineNum">    1576 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 3822 times"> + </span>]:<span class="lineCov">       3822 :   if (tz_was_altered)</span>
<span class="lineNum">    1577 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :     ok &amp;= (tz0 ? setenv (&quot;TZ&quot;, tz0, 1) : unsetenv (&quot;TZ&quot;)) == 0;</span>
<span class="lineNum">    1578 </span>        [<span class="branchCov" title="Branch 0 was taken 3822 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       3822 :   if (tz0 != tz0buf)</span>
<span class="lineNum">    1579 </span>                :<span class="lineCov">       3822 :     free (tz0);</span>
<span class="lineNum">    1580 </span>                :<span class="lineCov">       3822 :   return ok;</span>
<span class="lineNum">    1581 </span>                :            : }
<span class="lineNum">    1582 </span>                :            : 
<span class="lineNum">    1583 </span>                :            : #if TEST
<span class="lineNum">    1584 </span>                :            : 
<span class="lineNum">    1585 </span>                :            : int
<span class="lineNum">    1586 </span>                :            : main (int ac, char **av)
<span class="lineNum">    1587 </span>                :            : {
<span class="lineNum">    1588 </span>                :            :   char buff[BUFSIZ];
<span class="lineNum">    1589 </span>                :            : 
<span class="lineNum">    1590 </span>                :            :   printf (&quot;Enter date, or blank line to exit.\n\t&gt; &quot;);
<span class="lineNum">    1591 </span>                :            :   fflush (stdout);
<span class="lineNum">    1592 </span>                :            : 
<span class="lineNum">    1593 </span>                :            :   buff[BUFSIZ - 1] = '\0';
<span class="lineNum">    1594 </span>                :            :   while (fgets (buff, BUFSIZ - 1, stdin) &amp;&amp; buff[0])
<span class="lineNum">    1595 </span>                :            :     {
<span class="lineNum">    1596 </span>                :            :       struct timespec d;
<span class="lineNum">    1597 </span>                :            :       struct tm const *tm;
<span class="lineNum">    1598 </span>                :            :       if (! parse_datetime (&amp;d, buff, NULL))
<span class="lineNum">    1599 </span>                :            :         printf (&quot;Bad format - couldn't convert.\n&quot;);
<span class="lineNum">    1600 </span>                :            :       else if (! (tm = localtime (&amp;d.tv_sec)))
<span class="lineNum">    1601 </span>                :            :         {
<span class="lineNum">    1602 </span>                :            :           long int sec = d.tv_sec;
<span class="lineNum">    1603 </span>                :            :           printf (&quot;localtime (%ld) failed\n&quot;, sec);
<span class="lineNum">    1604 </span>                :            :         }
<span class="lineNum">    1605 </span>                :            :       else
<span class="lineNum">    1606 </span>                :            :         {
<span class="lineNum">    1607 </span>                :            :           int ns = d.tv_nsec;
<span class="lineNum">    1608 </span>                :            :           printf (&quot;%04ld-%02d-%02d %02d:%02d:%02d.%09d\n&quot;,
<span class="lineNum">    1609 </span>                :            :                   tm-&gt;tm_year + 1900L, tm-&gt;tm_mon + 1, tm-&gt;tm_mday,
<span class="lineNum">    1610 </span>                :            :                   tm-&gt;tm_hour, tm-&gt;tm_min, tm-&gt;tm_sec, ns);
<span class="lineNum">    1611 </span>                :            :         }
<span class="lineNum">    1612 </span>                :            :       printf (&quot;\t&gt; &quot;);
<span class="lineNum">    1613 </span>                :            :       fflush (stdout);
<span class="lineNum">    1614 </span>                :            :     }
<span class="lineNum">    1615 </span>                :            :   return 0;
<span class="lineNum">    1616 </span>                :            : }
<span class="lineNum">    1617 </span>                :            : #endif /* TEST */
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.9</a></td></tr>
  </table>
  <br>

</body>
</html>
